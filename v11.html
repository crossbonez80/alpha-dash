<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Alpha 交易赛分析终端</title>
    
    <!-- PWA Configuration -->
    <meta name="application-name" content="AlphaDash">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AlphaDash">
    <meta name="theme-color" content="#000000">

    <!-- Dynamic App Icon (SVG Data URI) -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%236366f1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z'/%3E%3Cpath d='M19 3v4'/%3E%3Cpath d='M21 5h-4'/%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%230f172a' stroke='%236366f1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect width='24' height='24' fill='white'/%3E%3Cpath d='M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z'/%3E%3Cpath d='M19 3v4'/%3E%3Cpath d='M21 5h-4'/%3E%3C/svg%3E">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            bg: '#020617',
                            card: '#0f172a',
                            border: 'rgba(255, 255, 255, 0.08)'
                        }
                    },
                    animation: {
                        'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'blob': 'blob 10s infinite',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        }
                    },
                    backgroundImage: {
                        'grid-white': "url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32' width='32' height='32' fill='none' stroke='rgb(255 255 255 / 0.05)'%3e%3cpath d='M0 .5H31.5V32'/%3e%3c/svg%3e\")",
                        'grid-black': "url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32' width='32' height='32' fill='none' stroke='rgb(0 0 0 / 0.05)'%3e%3cpath d='M0 .5H31.5V32'/%3e%3c/svg%3e\")",
                    }
                }
            }
        }
    </script>
    
    <!-- React & Recharts -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.3/umd/Recharts.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons (Vanilla JS - Stable for Browser Environment) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@600;700;800&display=swap');
        
        body { font-family: 'Inter', sans-serif; overscroll-behavior-y: none; }
        .font-rounded { font-family: 'Nunito', sans-serif; }
        
        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #475569; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Animation Utility Classes */
        .animate-in { animation-duration: 0.3s; animation-fill-mode: both; }
        .fade-in { animation-name: fadeIn; }
        .zoom-in-95 { animation-name: zoomIn95; }
        .slide-in-from-top-2 { animation-name: slideInFromTop2; }
        .slide-in-from-bottom-4 { animation-name: slideInFromBottom4; }
        .slide-in-from-left-2 { animation-name: slideInFromLeft2; }

        @keyframes slideInFromLeft2 {
            from { transform: translateX(-0.5rem); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Glassmorphism */
        .glass-panel {
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }
        
        /* Shimmer Effect */
        @keyframes shimmer {
            0% { transform: translateX(-150%) skewX(-20deg); }
            40%, 100% { transform: translateX(150%) skewX(-20deg); }
        }
        .animate-shimmer {
            animation: shimmer 3s infinite linear; 
        }

        /* Scan Line Animation for AI Button */
        @keyframes scan-line {
            0% { transform: translateY(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(200%); opacity: 0; }
        }
        .animate-scan {
            animation: scan-line 2s cubic-bezier(0.4, 0, 0.2, 1) infinite;
        }

        /* Text Flow Animation for AI Loading */
        @keyframes textFlow {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }
        .animate-text-flow {
            background: linear-gradient(90deg, #4f46e5, #9333ea, #4f46e5);
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: textFlow 2s linear infinite;
            font-weight: 800; /* Extra bold for better gradient visibility */
        }
        .dark .animate-text-flow {
            background: linear-gradient(90deg, #818cf8, #d8b4fe, #818cf8);
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
        }

        /* Progress Stripes */
        @keyframes progress-stripes {
            0% { background-position: 1rem 0; }
            100% { background-position: 0 0; }
        }
        .animate-stripes {
            background-image: linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);
            background-size: 1rem 1rem;
            animation: progress-stripes 1s linear infinite;
        }

        /* Pulse Ring */
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 0.5; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        .animate-pulse-ring {
            animation: pulse-ring 2s cubic-bezier(0, 0, 0.2, 1) infinite;
        }
        
        /* Dragging Styles */
        .draggable-card {
            cursor: grab;
            transition: transform 0.25s cubic-bezier(0.2, 0, 0.2, 1), opacity 0.2s;
            touch-action: none; /* Important for mobile drag */
        }
        .draggable-card:active {
            cursor: grabbing;
            transform: scale(1.02);
            z-index: 50;
        }
        /* Enhanced Dashed Placeholder Style */
        .draggable-card.dragging {
            opacity: 1; 
        }
        .draggable-card.dragging > div {
             opacity: 1 !important;
             border: 2px dashed #6366f1 !important;
             background-color: rgba(99, 102, 241, 0.05) !important; 
             box-shadow: none !important;
             backdrop-filter: none !important;
             transform: scale(0.95); 
             border-radius: 1.5rem !important;
        }
        .dark .draggable-card.dragging > div {
            background-color: rgba(99, 102, 241, 0.15) !important;
            border-color: #818cf8 !important;
        }
        .draggable-card.dragging > div > * {
            opacity: 0 !important;
            pointer-events: none;
        }
        
        /* Input Autofill Fix for Dark Mode */
        .dark input:-webkit-autofill,
        .dark input:-webkit-autofill:hover, 
        .dark input:-webkit-autofill:focus, 
        .dark input:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 30px #0f172a inset !important;
            -webkit-text-fill-color: white !important;
        }
        
        input:-webkit-autofill,
        input:-webkit-autofill:hover, 
        input:-webkit-autofill:focus, 
        input:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 30px #f8fafc inset !important;
            -webkit-text-fill-color: #0f172a !important;
        }
        
        /* New utility to delay animations for randomness */
        .animation-delay-2000 { animation-delay: 2s; }
        .animation-delay-4000 { animation-delay: 4s; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-[#020617] text-slate-900 dark:text-slate-200 selection:bg-blue-500/30 transition-colors duration-300 p-2 md:p-4 overflow-x-hidden relative">
    <div id="root"></div>

    <script type="text/babel">
        // --- Crash Prevention Utilities ---
        
        // Helper to safely parse JSON from localStorage without crashing
        const safeJSONParse = (key, fallback) => {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : fallback;
            } catch (e) {
                console.warn(`AlphaDash: Resetting corrupted data for ${key}`);
                return fallback;
            }
        };

        // Ensure Recharts is loaded before destructuring
        const Recharts = window.Recharts || {};
        const { AreaChart, Area, ComposedChart, Bar, Line, Cell, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend } = Recharts;
        const { useState, useMemo, useEffect, useRef, useCallback } = React;
        
        // --- Robust Icon Component using Vanilla Lucide ---
        const Icon = ({ name, size = 16, className, fill }) => {
            const ref = useRef(null);

            useEffect(() => {
                if (window.lucide && window.lucide.createIcons && ref.current) {
                    ref.current.innerHTML = ''; 
                    const i = document.createElement('i');
                    i.setAttribute('data-lucide', name);
                    ref.current.appendChild(i);
                    window.lucide.createIcons({
                        root: ref.current,
                        nameAttr: 'data-lucide',
                        attrs: {
                            width: size,
                            height: size,
                            class: className || "",
                            stroke: "currentColor",
                            fill: fill || "none",
                            "stroke-width": 2
                        }
                    });
                }
            }, [name, size, className, fill]);

            return <span ref={ref} className={`inline-flex items-center justify-center ${className || ''}`} style={{ width: size, height: size }}></span>;
        };

        // --- Core Components ---

        // Reusable Modal Component with customizable width and high z-index
        const Modal = ({ isOpen, onClose, title, children, maxWidth = "max-w-lg" }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200" onClick={onClose}>
                    <div className={`bg-white dark:bg-slate-900 rounded-3xl w-full ${maxWidth} max-h-[90vh] overflow-y-auto shadow-2xl border border-slate-200 dark:border-slate-800 animate-in zoom-in-95 duration-200 flex flex-col`} onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center p-4 border-b border-slate-100 dark:border-slate-800">
                            <h3 className="text-lg font-bold text-slate-800 dark:text-white">{title}</h3>
                            <button onClick={onClose} className="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors"><Icon name="x" size={20} /></button>
                        </div>
                        <div className="p-4 md:p-6 overflow-y-auto custom-scrollbar">
                            {children}
                        </div>
                    </div>
                </div>
            );
        };

        // Custom Tooltip
        const CustomTooltip = ({ active, payload, label, t }) => {
            if (active && payload && payload.length) {
                return (
                    <div className="bg-white/95 dark:bg-[#0f172a]/95 backdrop-blur-xl p-4 rounded-2xl border border-slate-200 dark:border-white/10 shadow-xl dark:shadow-[0_0_40px_-10px_rgba(0,0,0,0.7)] min-w-[200px] z-50">
                        <p className="text-slate-500 dark:text-slate-400 text-[10px] font-bold uppercase tracking-wider mb-3">{label}</p>
                        <div className="flex items-center justify-between gap-4 mb-2">
                            <div className="flex items-center gap-2">
                                <div className="w-1.5 h-1.5 rounded-full bg-blue-500 shadow-md"></div>
                                <span className="text-xs text-slate-600 dark:text-slate-300 font-medium">{t.legendThreshold}</span>
                            </div>
                            <span className="text-sm font-mono font-bold text-slate-900 dark:text-white">${payload[0].value.toLocaleString()}</span>
                        </div>
                        {payload[1] && (
                            <div className="flex items-center justify-between gap-4">
                                <div className="flex items-center gap-2">
                                    <div className="w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-md"></div>
                                    <span className="text-xs text-slate-600 dark:text-slate-300 font-medium">{t.legendUser}</span>
                                </div>
                                <span className="text-sm font-mono font-bold text-emerald-600 dark:text-emerald-400">
                                    ${payload[1].value.toLocaleString()}
                                </span>
                            </div>
                        )}
                        {payload[1] && (
                            <div className={`mt-3 pt-2 border-t border-slate-100 dark:border-white/10 text-xs font-bold flex justify-between ${payload[1].value >= payload[0].value ? 'text-emerald-600 dark:text-emerald-500' : 'text-rose-600 dark:text-rose-500'}`}>
                                <span>{payload[1].value >= payload[0].value ? t.statusSafe : t.statusRisk}</span>
                                <span>{payload[1].value >= payload[0].value ? '+' : ''}{((payload[1].value - payload[0].value) / payload[0].value * 100).toFixed(1)}%</span>
                            </div>
                        )}
                    </div>
                );
            }
            return null;
        };

        // --- Card Components ---
        const RewardCard = ({ stats, coinPrice, currentComp, t }) => (
            <div className="relative rounded-3xl p-[1px] bg-gradient-to-br from-amber-300 via-orange-400 to-yellow-400 shadow-sm hover:shadow-xl dark:shadow-lg dark:hover:shadow-amber-900/30 transition-all duration-300 group h-full hover:-translate-y-1 hover:scale-[1.02]">
                <div className="relative overflow-hidden bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-50 dark:bg-none dark:bg-[#1a1005]/90 active:bg-amber-100 dark:active:bg-slate-950 backdrop-blur-md rounded-[23px] h-full p-4 md:p-6 flex flex-col">
                    <div className="absolute top-3 right-3 z-20 opacity-30 group-hover:opacity-100 transition-opacity duration-200 cursor-grab active:cursor-grabbing">
                        <Icon name="grip-horizontal" size={20} className="text-amber-900/40 dark:text-amber-100/40" />
                    </div>
                    <div className="absolute inset-0 bg-gradient-to-br from-amber-300/50 dark:from-amber-900/20 to-transparent opacity-50"></div>
                    <div className="absolute -right-4 -top-4 opacity-[0.15] group-hover:opacity-[0.25] transition-all duration-500 transform group-hover:scale-110 group-active:scale-125 group-hover:rotate-12 group-active:rotate-12">
                        <Icon name="gift" size={120} className="text-amber-600 dark:text-amber-300" />
                    </div>
                    <div className="relative z-10 flex-1 flex flex-col">
                        <div className="flex items-center gap-3 mb-3">
                            <div className="relative">
                                 <div className="absolute inset-0 rounded-xl animate-pulse-ring bg-amber-500"></div>
                                 <div className="relative z-10 w-8 h-8 rounded-xl border flex items-center justify-center bg-white/60 dark:bg-amber-500/10 text-amber-600 dark:text-amber-400 border-amber-200 dark:border-amber-500/20 shadow-sm"><Icon name="coins" size={18} /></div>
                            </div>
                            <div className="text-amber-900/70 dark:text-amber-200/70 text-xs font-bold uppercase tracking-widest">{t.rewardEst}</div>
                        </div>
                        <div className="flex items-baseline gap-0.5 text-amber-950 dark:text-white">
                            <span className="text-xl font-bold text-amber-700/70 dark:text-amber-400/70">$</span>
                            <span className="text-4xl font-extrabold tracking-tight drop-shadow-sm dark:drop-shadow-lg text-amber-950 dark:text-white">
                                {stats.latestReward ? (stats.latestReward * coinPrice).toLocaleString(undefined, {maximumFractionDigits: 2}) : '0.00'}
                            </span>
                        </div>
                        <div className="mt-2 flex items-center justify-between">
                            <div className="text-[10px] font-bold text-amber-900 dark:text-white flex items-center justify-center bg-white/60 dark:bg-amber-900/30 px-2 py-0.5 rounded-md border border-amber-200/50 dark:border-amber-500/20 shadow-sm">
                                <span>{stats.latestReward ? stats.latestReward.toLocaleString() : '-'} <span className="opacity-60 ml-0.5">{currentComp.symbol}</span></span>
                            </div>
                            <div className="text-[10px] font-bold text-amber-900 dark:text-white flex items-center justify-center bg-white/60 dark:bg-amber-900/30 px-2 py-0.5 rounded-md border border-amber-200/50 dark:border-amber-500/20 shadow-sm">
                                <span><span className="opacity-60 mr-0.5">TOP</span> {stats.latestEligibility ? stats.latestEligibility : '-'}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );

        const PredictionCard = ({ stats, t }) => (
            <div className="relative rounded-3xl p-[1px] bg-gradient-to-br from-violet-300 via-purple-400 to-fuchsia-400 shadow-sm hover:shadow-xl dark:shadow-lg dark:hover:shadow-violet-900/30 transition-all duration-300 group h-full hover:-translate-y-1 hover:scale-[1.02]">
                <div className="relative overflow-hidden bg-gradient-to-br from-violet-50 via-purple-50 to-fuchsia-50 dark:bg-none dark:bg-[#150a1f]/90 active:bg-violet-100 dark:active:bg-slate-950 backdrop-blur-md rounded-[23px] h-full p-4 md:p-6 flex flex-col">
                    <div className="absolute top-3 right-3 z-20 opacity-30 group-hover:opacity-100 transition-opacity duration-200 cursor-grab active:cursor-grabbing">
                        <Icon name="grip-horizontal" size={20} className="text-violet-900/40 dark:text-violet-100/40" />
                    </div>
                    <div className="absolute inset-0 bg-gradient-to-br from-violet-300/50 dark:from-violet-900/20 to-transparent opacity-50"></div>
                    <div className="absolute -right-4 -top-4 opacity-[0.15] group-hover:opacity-[0.25] transition-all duration-500 transform group-hover:scale-110 group-active:scale-125 group-hover:-rotate-12 group-active:-rotate-12">
                        <Icon name="sparkles" size={120} className="text-violet-600 dark:text-violet-300" />
                    </div>
                    <div className="relative z-10 flex-1 flex flex-col">
                        <div className="flex items-center gap-3 mb-3">
                            <div className="relative">
                                <div className="absolute inset-0 rounded-xl animate-pulse-ring bg-violet-500"></div>
                                <div className="relative z-10 w-8 h-8 rounded-xl border flex items-center justify-center bg-white/60 dark:bg-violet-500/10 text-violet-600 dark:text-violet-400 border-violet-200 dark:border-violet-500/20 shadow-sm"><Icon name="bot" size={18} /></div>
                            </div>
                            <div className="text-violet-900/70 dark:text-violet-200/70 text-xs font-bold uppercase tracking-widest">{t.predictedNext}</div>
                        </div>
                        <div className="flex items-baseline gap-0.5 text-violet-950 dark:text-white">
                            <span className="text-xl font-bold text-violet-700/70 dark:text-violet-400/70">$</span>
                            <span className="text-3xl font-extrabold tracking-tight drop-shadow-sm dark:drop-shadow-lg">{stats.predictedNext.toLocaleString(undefined, {maximumFractionDigits:0})}</span>
                        </div>
                        <div className="mt-2 text-xs font-medium text-violet-800/80 dark:text-violet-400/80">{t.linearTrend}</div>
                    </div>
                </div>
            </div>
        );

        const ThresholdCard = ({ stats, t }) => (
            <div className="relative rounded-3xl p-[1px] bg-gradient-to-br from-blue-300 via-cyan-400 to-indigo-400 shadow-sm hover:shadow-xl dark:shadow-lg dark:hover:shadow-blue-900/30 transition-all duration-300 group h-full hover:-translate-y-1 hover:scale-[1.02]">
                <div className="relative overflow-hidden bg-gradient-to-br from-blue-50 via-cyan-50 to-indigo-50 dark:bg-none dark:bg-[#0a121f]/90 active:bg-blue-100 dark:active:bg-slate-950 backdrop-blur-md rounded-[23px] h-full p-4 md:p-6 flex flex-col">
                    <div className="absolute top-3 right-3 z-20 opacity-30 group-hover:opacity-100 transition-opacity duration-200 cursor-grab active:cursor-grabbing">
                        <Icon name="grip-horizontal" size={20} className="text-blue-900/40 dark:text-blue-100/40" />
                    </div>
                    <div className="absolute inset-0 bg-gradient-to-br from-blue-300/50 dark:from-blue-900/20 to-transparent opacity-50"></div>
                    <div className="absolute -right-4 -top-4 opacity-[0.15] group-hover:opacity-[0.25] transition-all duration-500 transform group-hover:scale-110 group-active:scale-125 group-hover:rotate-12 group-active:rotate-12">
                        <Icon name="target" size={120} className="text-blue-600 dark:text-blue-300" />
                    </div>
                    <div className="relative z-10 flex-1 flex flex-col">
                        <div className="flex items-center gap-3 mb-3">
                            <div className="relative">
                                <div className="absolute inset-0 rounded-xl animate-pulse-ring bg-blue-500"></div>
                                <div className="relative z-10 w-8 h-8 rounded-xl border flex items-center justify-center bg-white/60 dark:bg-blue-500/10 text-blue-600 dark:text-blue-400 border-blue-200 dark:border-blue-500/20 shadow-sm"><Icon name="crosshair" size={18} /></div>
                            </div>
                            <div className="text-blue-900/70 dark:text-blue-200/70 text-xs font-bold uppercase tracking-widest">{t.currentThreshold}</div>
                        </div>
                        <div className="flex items-baseline gap-0.5 text-blue-950 dark:text-white">
                            <span className="text-xl font-bold text-blue-700/70 dark:text-blue-400/70">$</span>
                            <span className="text-3xl font-extrabold tracking-tight drop-shadow-sm dark:drop-shadow-lg">{stats.current.toLocaleString()}</span>
                        </div>
                        <div className="mt-2 flex items-center justify-between">
                            <div className="text-xs font-medium text-blue-800/80 dark:text-blue-400/80 flex items-center gap-1">
                                <div className="w-1.5 h-1.5 rounded-full bg-blue-600 dark:bg-blue-400 animate-pulse"></div> {t.liveUpdate}
                            </div>
                            <div className="text-[10px] font-bold text-blue-800/80 dark:text-blue-300/70 flex items-center gap-1 bg-white/60 dark:bg-blue-900/30 px-2 py-0.5 rounded-md border border-blue-200/50 dark:border-blue-500/20 shadow-sm">
                                <Icon name="user" size={10} /> ${stats.latestUserVolume.toLocaleString()}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );

        // Renamed from GrowthCard to PriceCard, uses stats.priceChange (passed via props) instead of threshold growth
        const PriceCard = ({ coinPrice, priceChange, t, currentComp }) => {
            // Determine styling based on positive/negative change
            const isPositive = priceChange >= 0;
            
            // Wrapper Gradient (Border effect)
            const gradientClass = isPositive 
                ? 'from-emerald-300 via-green-400 to-teal-400 dark:from-emerald-500 dark:via-green-500 dark:to-teal-500' 
                : 'from-rose-300 via-red-400 to-orange-400 dark:from-rose-500 dark:via-red-500 dark:to-orange-500';
            
            // Background: Light (Pale Gradient) vs Dark (Dark Solid)
            const bgClass = isPositive 
                ? 'bg-gradient-to-br from-emerald-50 via-green-50 to-teal-50 dark:bg-none dark:bg-[#0f172a]' 
                : 'bg-gradient-to-br from-rose-50 via-red-50 to-orange-50 dark:bg-none dark:bg-[#0f172a]';
            
            // Text Colors: Light (Dark Text) vs Dark (White Text)
            const labelColor = isPositive ? 'text-emerald-900/70 dark:text-slate-400' : 'text-rose-900/70 dark:text-slate-400';
            const dollarColor = 'text-slate-900/70 dark:text-white/50';
            const valueColor = 'text-slate-900 dark:text-white';
            const trendColor = isPositive ? 'text-emerald-700 dark:text-emerald-400' : 'text-rose-700 dark:text-rose-400';
            const subTextColor = isPositive ? 'text-emerald-800/60 dark:text-slate-400' : 'text-rose-800/60 dark:text-slate-400';
            
            // Icon Colors
            const iconWatermarkColor = isPositive ? 'text-emerald-600 dark:text-emerald-500' : 'text-rose-600 dark:text-rose-500';
            const ringColor = isPositive ? 'bg-emerald-500' : 'bg-rose-500';
            const iconBg = isPositive
                ? 'bg-white/60 dark:bg-slate-800 text-emerald-600 dark:text-white border-emerald-200 dark:border-slate-700 shadow-sm'
                : 'bg-white/60 dark:bg-slate-800 text-rose-600 dark:text-white border-rose-200 dark:border-slate-700 shadow-sm';

            return (
                <div className={`relative rounded-3xl p-[1px] bg-gradient-to-br ${gradientClass} shadow-sm hover:shadow-xl dark:shadow-lg transition-all duration-300 group h-full hover:-translate-y-1 hover:scale-[1.02]`}>
                    <div className={`relative overflow-hidden ${bgClass} active:bg-slate-200 dark:active:bg-slate-950 backdrop-blur-md rounded-[23px] h-full p-4 md:p-6 flex flex-col`}>
                        <div className="absolute top-3 right-3 z-20 opacity-30 group-hover:opacity-100 transition-opacity duration-200 cursor-grab active:cursor-grabbing">
                            <Icon name="grip-horizontal" size={20} className="text-slate-400 dark:text-slate-600" />
                        </div>
                        
                        {/* Subtle background glow based on trend (Dark mode only) */}
                        <div className={`absolute inset-0 bg-gradient-to-br ${isPositive ? 'dark:from-emerald-500/10' : 'dark:from-rose-500/10'} to-transparent opacity-0 dark:opacity-100`}></div>
                        
                        <div className={`absolute -right-4 -top-4 opacity-[0.15] group-hover:opacity-[0.25] transition-all duration-500 transform group-hover:scale-110 group-active:scale-125 group-hover:-rotate-12 group-active:-rotate-12 ${iconWatermarkColor}`}>
                            <Icon name="activity" size={120} />
                        </div>
                        <div className="relative z-10 flex-1 flex flex-col">
                            <div className="flex items-center gap-3 mb-3">
                                <div className="relative">
                                    <div className={`absolute inset-0 rounded-xl animate-pulse-ring ${ringColor}`}></div>
                                    <div className={`relative z-10 w-8 h-8 rounded-xl border flex items-center justify-center shadow-sm ${iconBg}`}>
                                        <Icon name={currentComp.icon || "coins"} size={18} />
                                    </div>
                                </div>
                                <div className={`${labelColor} text-xs font-bold uppercase tracking-widest`}>{t.realTimePrice}</div>
                            </div>
                            <div className="flex items-baseline gap-1">
                                <span className={`text-xl font-bold ${dollarColor}`}>$</span>
                                <span className={`text-3xl font-extrabold tracking-tight drop-shadow-sm ${valueColor}`}>
                                    {coinPrice > 1 ? coinPrice.toLocaleString(undefined, {maximumFractionDigits: 2}) : coinPrice.toFixed(6)}
                                </span>
                            </div>
                            <div className={`mt-2 text-xs font-bold flex items-center gap-1 ${trendColor}`}>
                                <Icon name={isPositive ? "trending-up" : "trending-down"} size={14} />
                                {isPositive ? '+' : ''}{priceChange ? priceChange.toFixed(2) : '0.00'}% 
                                <span className={`font-medium ml-1 ${subTextColor}`}>{t.priceChange}</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const CountdownCard = ({ startDate, endDate, symbol, t }) => {
            const [timeLeft, setTimeLeft] = useState({ days: 0, hours: 0, minutes: 0, seconds: 0, status: 'noData', progress: 0 });

            useEffect(() => {
                const calculateTime = () => {
                    const now = new Date();
                    const currentTime = now.getTime();
                    
                    const start = startDate ? new Date(startDate).getTime() : null;
                    const end = endDate ? new Date(endDate).getTime() : null;
                    const currentSeconds = now.getSeconds();

                    if (!start || !end) {
                        setTimeLeft({ days: 0, hours: 0, minutes: 0, seconds: 0, status: 'noData', progress: 0 });
                        return;
                    }

                    let targetDate, status;

                    if (currentTime < start) {
                        targetDate = start;
                        status = 'startsIn';
                    } else if (currentTime >= start && currentTime <= end) {
                        targetDate = end;
                        status = 'endsIn';
                    } else {
                        status = 'ended';
                        setTimeLeft({ days: 0, hours: 0, minutes: 0, seconds: 0, status, progress: 100 });
                        return;
                    }

                    const difference = targetDate - currentTime;
                    const days = Math.floor(difference / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((difference % (1000 * 60)) / 1000); 

                    const secProgress = (currentSeconds / 60) * 100;

                    setTimeLeft({ days, hours, minutes, seconds, status, progress: secProgress });
                };

                calculateTime();
                const timer = setInterval(calculateTime, 1000); 
                return () => clearInterval(timer);
            }, [startDate, endDate]);

            const statusColors = {
                startsIn: 'text-indigo-700 dark:text-indigo-400',
                endsIn: 'text-cyan-700 dark:text-cyan-400',
                ended: 'text-slate-500 dark:text-slate-500',
                noData: 'text-slate-400 dark:text-slate-500'
            };
            
            const pulseColors = {
                startsIn: 'bg-indigo-500',
                endsIn: 'bg-cyan-500',
                ended: 'bg-slate-400',
                noData: 'bg-slate-400'
            };

            const borderGradients = {
                startsIn: 'from-indigo-300 via-purple-400 to-indigo-400',
                endsIn: 'from-cyan-300 via-blue-400 to-indigo-400',
                ended: 'from-slate-200 via-slate-300 to-slate-400 dark:from-slate-700 dark:via-slate-600 dark:to-slate-700',
                noData: 'from-slate-200 via-slate-300 to-slate-400 dark:from-slate-700 dark:via-slate-600 dark:to-slate-700'
            };

            const bgClass = {
                startsIn: 'bg-gradient-to-br from-indigo-50 via-purple-50 to-indigo-50 dark:bg-none',
                endsIn: 'bg-gradient-to-br from-cyan-50 via-blue-50 to-indigo-50 dark:bg-none',
                ended: 'bg-gradient-to-br from-slate-50 to-slate-100 dark:bg-none',
                noData: 'bg-slate-50 dark:bg-none'
            };

            const totalPixels = 40; 
            const activePixels = Math.floor((timeLeft.progress / 100) * totalPixels);

            return (
                <div className={`relative rounded-3xl p-[1px] bg-gradient-to-br ${borderGradients[timeLeft.status]} shadow-sm hover:shadow-xl dark:shadow-lg transition-all duration-300 group h-full hover:-translate-y-1 hover:scale-[1.02]`}>
                    <div className={`relative overflow-hidden ${bgClass[timeLeft.status]} dark:bg-[#0f101f]/90 active:bg-slate-200 dark:active:bg-slate-950 backdrop-blur-md rounded-[23px] h-full p-4 md:p-6 flex flex-col`}>
                        <div className="absolute top-3 right-3 z-20 opacity-30 group-hover:opacity-100 transition-opacity duration-200 cursor-grab active:cursor-grabbing">
                            <Icon name="grip-horizontal" size={20} className="text-slate-400/50 dark:text-slate-200/30" />
                        </div>
                        <div className={`absolute inset-0 bg-gradient-to-br ${timeLeft.status === 'endsIn' ? 'from-cyan-300/50 dark:from-cyan-900/10' : 'from-indigo-300/50 dark:from-indigo-900/10'} to-transparent opacity-50`}></div>
                        <div className={`absolute -right-4 -top-4 opacity-[0.15] group-hover:opacity-[0.25] transition-all duration-500 transform group-hover:scale-110 group-active:scale-125 group-hover:-rotate-12 group-active:-rotate-12 ${statusColors[timeLeft.status]}`}>
                            <Icon name="timer" size={120} />
                        </div>
                        <div className="relative z-10 flex-1 flex flex-col">
                            <div className="flex items-center gap-3 mb-3">
                                <div className="relative">
                                    <div className={`absolute inset-0 rounded-xl animate-pulse-ring ${pulseColors[timeLeft.status]}`}></div>
                                    <div className={`relative z-10 w-8 h-8 rounded-xl border flex items-center justify-center bg-white/60 dark:bg-white/5 ${statusColors[timeLeft.status]} border-white/20 shadow-sm`}>
                                        <Icon name={timeLeft.status === 'ended' ? "flag" : "clock"} size={18} />
                                    </div>
                                </div>
                                <div className="flex flex-col">
                                    <div className={`text-xs font-bold uppercase tracking-widest opacity-80 ${statusColors[timeLeft.status]}`}>{t.cardCountdown}</div>
                                    <div className="text-[10px] font-bold opacity-60 text-slate-700 dark:text-white">{symbol}</div>
                                </div>
                            </div>
                            
                            {timeLeft.status === 'ended' ? (
                                <div className="text-3xl font-extrabold tracking-tight drop-shadow-sm dark:drop-shadow-lg text-slate-500 dark:text-slate-400 mb-3">{t.ended}</div>
                            ) : (
                                <div className={`flex items-baseline gap-1 mb-3 ${statusColors[timeLeft.status]}`}>
                                    <span className="text-3xl font-extrabold tracking-tight drop-shadow-sm dark:drop-shadow-lg text-slate-800 dark:text-white">{timeLeft.days}</span>
                                    <span className="text-xs font-bold uppercase mr-1">d</span>
                                    <span className="text-3xl font-extrabold tracking-tight drop-shadow-sm dark:drop-shadow-lg text-slate-800 dark:text-white">{timeLeft.hours}</span>
                                    <span className="text-xs font-bold uppercase mr-1">h</span>
                                    <span className="text-3xl font-extrabold tracking-tight drop-shadow-sm opacity-80 text-slate-800 dark:text-white">{timeLeft.minutes}</span>
                                    <span className="text-xs font-bold uppercase mr-1 opacity-80">m</span>
                                </div>
                            )}

                            <div className="mt-auto">
                                {timeLeft.status !== 'ended' && timeLeft.status !== 'noData' && (
                                    <div className="relative">
                                        <div className="flex justify-between text-xs font-medium text-slate-600 dark:text-slate-400 mb-2">
                                            <span>{t[timeLeft.status]}</span>
                                            <span className="tabular-nums font-rounded font-bold">{timeLeft.seconds}s</span>
                                        </div>
                                        <div className="flex justify-between gap-[2px] h-3 w-full">
                                            {[...Array(totalPixels)].map((_, i) => {
                                                const isActive = i < activePixels;
                                                const hue = (i / totalPixels) * 360;
                                                const colorStyle = isActive ? { backgroundColor: `hsl(${hue}, 100%, 60%)`, boxShadow: `0 0 4px hsl(${hue}, 100%, 60%)` } : {};
                                                return <div key={i} className={`h-full flex-1 rounded-sm transition-all duration-300 ${isActive ? 'scale-y-110 opacity-100' : 'bg-slate-300 dark:bg-slate-800/60 opacity-40 scale-y-75'}`} style={colorStyle}></div>;
                                            })}
                                        </div>
                                    </div>
                                )}
                                {timeLeft.status === 'ended' && startDate && endDate && (
                                     <div className="text-[10px] font-mono text-slate-500 dark:text-slate-400 border-t border-slate-200 dark:border-slate-800 pt-2">
                                        {new Date(startDate).toLocaleDateString()} - {new Date(endDate).toLocaleDateString()}
                                     </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        // --- Pixel Chart Component ---
        const PixelChart = ({ data, t }) => {
            const [hoveredItem, setHoveredItem] = useState(null);
            if (!data || data.length === 0) return null;
            const maxVol = Math.max(...data.map(d => Math.max(d.volume, d.userVolume || 0))) * 1.2;
            const gridRows = 20; 

            return (
                <div className="w-full h-full flex flex-col items-center justify-end pb-2 pt-8 relative">
                     <div className={`absolute top-0 left-0 w-full flex justify-center z-30 pointer-events-none transition-all duration-300 ${hoveredItem ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-2'}`}>
                        {hoveredItem && (
                            <div className="bg-slate-900/95 dark:bg-black/90 text-white text-[11px] px-4 py-2 rounded-full backdrop-blur-md border border-white/10 shadow-[0_4px_20px_rgba(0,0,0,0.3)] flex gap-6 items-center">
                                <div className="font-bold text-indigo-300 border-r border-white/20 pr-4">{hoveredItem.displayDay}</div>
                                <div className="flex gap-4">
                                     <div className="flex items-center gap-2">
                                        <span className="text-slate-400 uppercase text-[9px] font-bold tracking-wider">Threshold</span>
                                        <span className="font-mono text-blue-400 font-bold text-sm">${hoveredItem.volume.toLocaleString()}</span>
                                     </div>
                                     <div className="w-[1px] h-4 bg-white/10"></div>
                                     <div className="flex items-center gap-2">
                                        <span className="text-slate-400 uppercase text-[9px] font-bold tracking-wider">You</span>
                                        <span className={`font-mono font-bold text-sm ${hoveredItem.userVolume >= hoveredItem.volume ? 'text-emerald-400' : 'text-rose-400'}`}>${hoveredItem.userVolume.toLocaleString()}</span>
                                     </div>
                                </div>
                            </div>
                        )}
                     </div>

                     <div className="w-full h-[360px] flex items-end justify-between px-2 gap-2 overflow-x-auto custom-scrollbar group/chart relative z-10">
                        {data.map((item, index) => {
                            const thresholdBlocks = Math.ceil((item.volume / maxVol) * gridRows);
                            const userBlocks = Math.ceil((item.userVolume / maxVol) * gridRows);
                            const isSafe = item.userVolume >= item.volume;
                            const isHovered = hoveredItem && hoveredItem.id === item.id;
                            
                            return (
                                <div 
                                    key={index} 
                                    className={`flex flex-col items-center gap-2 group min-w-[40px] transition-all duration-200 cursor-crosshair ${hoveredItem && !isHovered ? 'opacity-30 scale-95' : 'opacity-100 scale-100'}`}
                                    onMouseEnter={() => setHoveredItem(item)}
                                    onMouseLeave={() => setHoveredItem(null)}
                                >
                                    <div className="relative flex items-end gap-[2px] h-[300px]">
                                        <div className="flex flex-col-reverse gap-[1px]">
                                            {[...Array(gridRows)].map((_, i) => (
                                                <div key={`t-${i}`} className={`w-3 h-2 rounded-[1px] transition-all duration-300 ${i < thresholdBlocks ? 'bg-blue-500/80 shadow-[0_0_5px_rgba(59,130,246,0.3)]' : 'bg-slate-200/20 dark:bg-slate-800/20'}`}></div>
                                            ))}
                                        </div>
                                        <div className="flex flex-col-reverse gap-[1px]">
                                            {[...Array(gridRows)].map((_, i) => (
                                                <div key={`u-${i}`} className={`w-3 h-2 rounded-[1px] transition-all duration-300 ${i < userBlocks ? (isSafe ? 'bg-emerald-500/80 shadow-[0_0_5px_rgba(16,185,129,0.3)]' : 'bg-rose-500/80 shadow-[0_0_5px_rgba(244,63,94,0.3)]') : 'bg-slate-200/20 dark:bg-slate-800/20'}`}></div>
                                            ))}
                                        </div>
                                    </div>
                                    <span className={`text-[9px] font-mono font-bold uppercase transition-colors ${isHovered ? 'text-indigo-500 dark:text-indigo-400 scale-110' : 'text-slate-400 dark:text-slate-600'}`}>{item.displayDay.split(' ')[1]}</span>
                                </div>
                            );
                        })}
                     </div>
                     
                     <div className="flex gap-4 mt-4 text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest bg-slate-100/50 dark:bg-slate-800/50 px-4 py-2 rounded-full border border-slate-200 dark:border-slate-700/50">
                        <div className="flex items-center gap-1.5"><div className="w-2 h-2 bg-blue-500 rounded-[1px] shadow-[0_0_5px_rgba(59,130,246,0.5)]"></div> Threshold</div>
                        <div className="flex items-center gap-1.5"><div className="w-2 h-2 bg-emerald-500 rounded-[1px] shadow-[0_0_5px_rgba(16,185,129,0.5)]"></div> Safe</div>
                        <div className="flex items-center gap-1.5"><div className="w-2 h-2 bg-rose-500 rounded-[1px] shadow-[0_0_5px_rgba(244,63,94,0.5)]"></div> Risk</div>
                     </div>
                </div>
            );
        };

        // Default Config
        const defaultCompetitions = [
            { id: 'night', name: 'Midnight', symbol: 'NIGHT', coingeckoId: 'midnight-3', color: 'indigo', icon: 'moon', gradient: 'from-indigo-500 to-purple-600', startDate: new Date().toISOString().split('T')[0], endDate: new Date(Date.now() + 86400000 * 7).toISOString().split('T')[0] },
            { id: 'btc', name: 'Bitcoin', symbol: 'BTC', coingeckoId: 'bitcoin', color: 'orange', icon: 'bitcoin', gradient: 'from-orange-500 to-amber-500', startDate: new Date(Date.now() + 86400000 * 2).toISOString().split('T')[0], endDate: new Date(Date.now() + 86400000 * 16).toISOString().split('T')[0] },
            { id: 'eth', name: 'Ethereum', symbol: 'ETH', coingeckoId: 'ethereum', color: 'blue', icon: 'zap', gradient: 'from-blue-500 to-cyan-500', startDate: new Date(Date.now() - 86400000 * 3).toISOString().split('T')[0], endDate: new Date(Date.now() + 86400000 * 11).toISOString().split('T')[0] },
            { id: 'sol', name: 'Solana', symbol: 'SOL', coingeckoId: 'solana', color: 'emerald', icon: 'layers', gradient: 'from-emerald-400 to-teal-500', startDate: new Date(Date.now() + 86400000 * 5).toISOString().split('T')[0], endDate: new Date(Date.now() + 86400000 * 12).toISOString().split('T')[0] }
        ];

        const colorOptions = [
            { id: 'indigo', label: 'Indigo', gradient: 'from-indigo-500 to-purple-600', icon: 'moon' },
            { id: 'orange', label: 'Orange', gradient: 'from-orange-500 to-amber-500', icon: 'bitcoin' },
            { id: 'blue', label: 'Blue', gradient: 'from-blue-500 to-cyan-500', icon: 'zap' },
            { id: 'emerald', label: 'Emerald', gradient: 'from-emerald-400 to-teal-500', icon: 'layers' },
            { id: 'rose', label: 'Rose', gradient: 'from-rose-500 to-pink-600', icon: 'flame' },
            { id: 'violet', label: 'Violet', gradient: 'from-violet-500 to-fuchsia-600', icon: 'gem' },
            { id: 'cyan', label: 'Cyan', gradient: 'from-cyan-500 to-blue-600', icon: 'anchor' },
            { id: 'fuchsia', label: 'Fuchsia', gradient: 'from-fuchsia-500 to-pink-600', icon: 'crown' }
        ];

        const initialDataMap = {
            night: [
                { id: 'init-1', volume: 36129.54, userVolume: 42000.00, timestamp: new Date(Date.now() - 172800000).toISOString(), source: 'default', reward: 1700, eligibility: 20500 },
                { id: 'init-2', volume: 60689.17, userVolume: 58000.00, timestamp: new Date(Date.now() - 86400000).toISOString(), source: 'default', reward: 1700, eligibility: 20500 },
            ],
        };

        const translations = {
            zh: {
                subtitle: "数据驱动的交易赛入榜门槛预测系统", manualEntry: "手动输入", importScreenshot: "截图识别", analyzing: "AI 识别中...", currentThreshold: "当前入榜门槛", liveUpdate: "实时更新", growthRate: "24H 变动", vsYesterday: "较昨日同期", predictedNext: "明日预测目标", linearTrend: "基于线性趋势", rewardEst: "单号奖励估值 (USD)", rewardNote: "(按实时币价)", historySnapshot: "历史快照", growthCurve: "门槛与个人交易量趋势", aiAnalysis: "AI 深度策略预测", aiAnalyzing: "AI 分析中...", manualModalTitle: "手动录入", dateLabel: "日期", volumeLabel: "入榜门槛交易量 (USD)", userVolumeLabel: "您的交易量 (USD)", costLabel: "今日交易成本 (USD)", rewardLabel: "奖励数量 - 可选", eligibilityLabel: "合格名次 (如 20500)", confirmButton: "确认录入", aiPhase: "阶段", aiRisk: "风险评级", geminiInsight: "Gemini 赛项深度洞察", day: "Day", priceLive: "LIVE", priceEst: "EST", sourceAI: "AI", sourceMan: "人工", delete: "删除", edit: "编辑", errorTrend: "需要至少两条历史数据进行趋势预测", errorRecognize: "AI 未能识别内容", errorValid: "识别结果不是有效数字", promptStrategy: "你是一个专业的交易比赛分析师。请用中文回答。分析当前市场竞争阶段（如：早期积累、中期拉升、冲刺阶段）和风险等级（低、中、高）。并给出针对性的冲榜策略建议（简短有力，100字以内）。根据以下历史入榜门槛数据序列：", switchCompetition: "切换交易赛", selectCompetition: "选择要分析的币种赛道", addCompetition: "添加新赛道", editCompetition: "编辑赛道", compName: "币种名称 (如 Bitcoin)", compSymbol: "代币符号 (如 BTC)", compCgId: "CoinGecko ID / URL (用于价格)", compColor: "主题颜色", save: "保存配置", cancel: "取消", deleteConfirmTitle: "确认删除", deleteConfirmDesc: "确定要删除这个赛道吗？所有相关的历史数据都将永久丢失且无法恢复。", confirmDelete: "确认删除", cgIdHint: "在 coingecko.com 网址中找到，例如 'bitcoin'", gap: "差距", statusSafe: "安全", statusRisk: "危险", legendThreshold: "入榜门槛", legendUser: "您的交易量", statusTitle: "当前状态", lead: "领先门槛", lag: "落后门槛", themeLight: "亮色", themeDark: "暗色", settings: "设置", apiKeyLabel: "Gemini API Keys (支持多Key轮询)", apiKeyPlaceholder: "在此粘贴 API Key", saveKey: "保存设置", clearKey: "清除所有", apiKeyHint: "系统会自动使用第一个可用的 API Key。如果主 Key 失效，会自动切换到备用 Key。Key 仅保存在本地。", errorApiKey: "未检测到有效的 API Key。请在设置中输入您的 Gemini API Key 以使用 AI 功能。", cardCountdown: "比赛倒计时", startsIn: "距离开始", endsIn: "距离结束", ended: "已结束", periodLabel: "比赛周期 (官方 UTC+8 标准)", startLabel: "开始时间", endLabel: "结束时间", subCardReward: "单号代币", subCardRank: "入围名次", hourLabel: "时", minuteLabel: "分", key1Label: "主 API Key", key2Label: "备用 Key 1", key3Label: "备用 Key 2", developer: "开发者", about: "关于", donation: "捐赠", aboutTitle: "关于 AlphaDash", aboutDesc: "AlphaDash 是一个专为交易赛设计的辅助分析工具，旨在帮助用户追踪排名门槛、分析数据趋势并制定冲榜策略。本工具完全运行在本地浏览器中，您的 API Key 和数据均存储在本地 LocalStorage，不会上传至任何服务器。", donationTitle: "支持开发者", donationDesc: "如果您觉得这个工具对您有帮助，欢迎打赏支持后续开发！", copy: "复制", copied: "已复制", followX: "关注 X", version: "版本 v10.6", dataMgmt: "数据管理", exportData: "导出备份", importData: "导入恢复", importConfirm: "确定要导入数据吗？这将覆盖当前的赛道配置和历史记录。", importSuccess: "数据恢复成功！",
                realTimePrice: "实时币价 (USD)", priceChange: "24H 涨跌幅", marketIntelTitle: "市场情报", hub: "中心", analysis: "AI 深度分析", visitorCount: "今日访问热度", legendTotalVolume: "总交易量"
            },
            en: {
                subtitle: "Data-driven Competition Threshold Prediction System", manualEntry: "Entry", importScreenshot: "Scan", analyzing: "Scanning...", currentThreshold: "Current Threshold", liveUpdate: "Live Update", growthRate: "24H Change", vsYesterday: "vs Yesterday", predictedNext: "Next Day Target", linearTrend: "Linear Trend Based", rewardEst: "Est. Reward Value (USD)", rewardNote: "(Live Price)", historySnapshot: "History Snapshots", growthCurve: "Threshold vs User Volume", aiAnalysis: "AI Strategy Insight", aiAnalyzing: "Analyzing...", manualModalTitle: "Manual Entry", dateLabel: "Date", volumeLabel: "Threshold Volume (USD)", userVolumeLabel: "Your Volume (USD)", costLabel: "Today's Cost (USD)", rewardLabel: "Reward Amount - Optional", eligibilityLabel: "Eligibility Rank (e.g. 20500)", confirmButton: "Confirm Entry", aiPhase: "Phase", aiRisk: "Risk Level", geminiInsight: "Gemini Competition Insight", day: "Day", priceLive: "LIVE", priceEst: "EST", sourceAI: "AI", sourceMan: "MANUAL", delete: "Delete", edit: "Edit", errorTrend: "Need at least 2 data points for prediction", errorRecognize: "AI failed to recognize content", errorValid: "Result is not a valid number", promptStrategy: "You are a professional trading competition analyst. Please respond in English. Analyze current market phase (e.g. Accumulation, Surge, Final Sprint) and Risk Level (Low, Medium, High). Give specific strategy advice (short and concise, under 100 words). Based on the following historical threshold data sequence:", switchCompetition: "Switch Competition", selectCompetition: "Select Competition Track", addCompetition: "Add New Track", editCompetition: "Edit Track", compName: "Coin Name (e.g. Bitcoin)", compSymbol: "Token Symbol (e.g. BTC)", compCgId: "CoinGecko ID / URL (for price)", compColor: "Theme Color", save: "Save Configuration", cancel: "Cancel", deleteConfirmTitle: "Confirm Deletion", deleteConfirmDesc: "Are you sure you want to delete this track? All historical data associated with it will be permanently lost.", confirmDelete: "Delete Track", cgIdHint: "Find in coingecko.com URL, e.g. 'bitcoin'", gap: "Gap", statusSafe: "Safe", statusRisk: "Risk", legendThreshold: "Threshold", legendUser: "Your Volume", statusTitle: "Current Status", lead: "Leading Threshold", lag: "Trailing Threshold", themeLight: "Light", themeDark: "Dark", settings: "Settings", apiKeyLabel: "Gemini API Keys (Multi-key Failover)", apiKeyPlaceholder: "Paste API Key here", saveKey: "Save Settings", clearKey: "Clear All", apiKeyHint: "System automatically uses the first available key and switches to backup keys if quota is exceeded.", errorApiKey: "No valid API Key found. Please enter at least one Gemini API Key in Settings.", cardCountdown: "Time Remaining", startsIn: "Starts In", endsIn: "Ends In", ended: "Ended", periodLabel: "Competition Period (UTC+8 Standard)", startLabel: "Start Date", endLabel: "End Date", subCardReward: "Tokens/User", subCardRank: "Rank Limit", hourLabel: "Hr", minuteLabel: "Min", key1Label: "Primary Key", key2Label: "Backup Key 1", key3Label: "Backup Key 2", developer: "Developer", about: "About", donation: "Donate", aboutTitle: "About AlphaDash", aboutDesc: "AlphaDash is an analytical tool designed for trading competitions, helping users track threshold volumes, analyze trends, and formulate strategies. This tool runs entirely in your local browser. Your API Keys and data are stored locally in LocalStorage and are never uploaded to any server.", donationTitle: "Support Development", donationDesc: "If you find this tool helpful, please consider donating to support future development!", copy: "Copy", copied: "Copied", followX: "Follow X", version: "Version v10.6", dataMgmt: "Data Management", exportData: "Export Backup (JSON)", importData: "Import Backup (JSON)", importConfirm: "Are you sure you want to import data? This will overwrite current tracks and history.", importSuccess: "Data restored successfully!",
                realTimePrice: "Live Price (USD)", priceChange: "24H Change", marketIntelTitle: "Market Intelligence", hub: "HUB", analysis: "AI Analysis", visitorCount: "Daily Activity", legendTotalVolume: "Total Volume"
            }
        };

        const App = () => {
            const [lang, setLang] = useState('zh');
            const [theme, setTheme] = useState('dark'); 
            const [showLangMenu, setShowLangMenu] = useState(false); // State for language dropdown
            const t = translations[lang];
            
            // Visitor Counter Logic (Persistent Simulation)
            const [visitorCount, setVisitorCount] = useState(() => {
                const savedCount = safeJSONParse('alpha_dash_visitors', null);
                const lastTime = safeJSONParse('alpha_dash_last_time', null);
                const now = Date.now();
                
                let count = 12540;
                
                if (savedCount && lastTime) {
                    count = parseInt(savedCount, 10);
                    const timeDiff = now - parseInt(lastTime, 10);
                    const growthWhileAway = Math.floor(timeDiff / 15000);
                    count += growthWhileAway;
                } else {
                    count += Math.floor(Math.random() * 500);
                }
                
                return count;
            });

            useEffect(() => {
                localStorage.setItem('alpha_dash_visitors', visitorCount);
                localStorage.setItem('alpha_dash_last_time', Date.now());

                const interval = setInterval(() => {
                    setVisitorCount(prev => {
                        const shouldIncrement = Math.random() > 0.6; 
                        const next = shouldIncrement ? prev + 1 : prev;
                        
                        if (shouldIncrement) {
                            localStorage.setItem('alpha_dash_visitors', next);
                            localStorage.setItem('alpha_dash_last_time', Date.now());
                        }
                        return next;
                    });
                }, 3000);
                return () => clearInterval(interval);
            }, []);

            const [cardOrder, setCardOrder] = useState(() => {
                const savedOrder = safeJSONParse('card_order', null);
                return savedOrder ? savedOrder : ['reward', 'countdown', 'prediction', 'threshold', 'growth'];
            });
            const [draggedItem, setDraggedItem] = useState(null);

            useEffect(() => {
                const root = window.document.documentElement;
                const metaThemeColor = document.querySelector("meta[name=theme-color]");
                
                if (theme === 'dark') {
                    root.classList.add('dark');
                    document.body.classList.add('dark');
                    if(metaThemeColor) metaThemeColor.setAttribute("content", "#000000");
                } else {
                    root.classList.remove('dark');
                    document.body.classList.remove('dark');
                    if(metaThemeColor) metaThemeColor.setAttribute("content", "#f8fafc");
                }
            }, [theme]);

            const [competitions, setCompetitions] = useState(() => {
                const saved = safeJSONParse('night_competitions', null);
                return saved ? saved : defaultCompetitions;
            });

            useEffect(() => {
                localStorage.setItem('night_competitions', JSON.stringify(competitions));
            }, [competitions]);

            const [currentComp, setCurrentComp] = useState(competitions[0]);
            const [dataList, setDataList] = useState(() => {
                const savedData = safeJSONParse(`night_data_${defaultCompetitions[0].id}`, null);
                return savedData ? savedData : initialDataMap[defaultCompetitions[0].id];
            });

            const [showCompModal, setShowCompModal] = useState(false);
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [isGeneratingStrategy, setIsGeneratingStrategy] = useState(false);
            const [showManualModal, setShowManualModal] = useState(false);
            const [aiStrategy, setAiStrategy] = useState(null);
            const [error, setError] = useState(null);
            
            const [editingItem, setEditingItem] = useState(null);
            const [showPeriodInputs, setShowPeriodInputs] = useState(true);
            
            const [manualVolume, setManualVolume] = useState('');
            const [manualUserVolume, setManualUserVolume] = useState('');
            const [manualCost, setManualCost] = useState('');
            const [manualReward, setManualReward] = useState('');
            const [manualEligibility, setManualEligibility] = useState('');
            const [manualDate, setManualDate] = useState(new Date().toISOString().split('T')[0]);
            
            const [manualStartDate, setManualStartDate] = useState('');
            const [manualStartHour, setManualStartHour] = useState('00');
            const [manualStartMinute, setManualStartMinute] = useState('00');
            const [manualEndDate, setManualEndDate] = useState('');
            const [manualEndHour, setManualEndHour] = useState('00');
            const [manualEndMinute, setManualEndMinute] = useState('00');

            const [showManageModal, setShowManageModal] = useState(false);
            const [editingComp, setEditingComp] = useState(null);
            const [compForm, setCompForm] = useState({ name: '', symbol: '', coingeckoId: '', color: 'indigo' });

            const [showDeleteModal, setShowDeleteModal] = useState(false);
            const [deleteTargetId, setDeleteTargetId] = useState(null);

            const [showSettingsModal, setShowSettingsModal] = useState(false);
            const [showAboutModal, setShowAboutModal] = useState(false);
            const [showDonationModal, setShowDonationModal] = useState(false);
            
            const [chartViewMode, setChartViewMode] = useState('curve');
            const [isAICollapsed, setIsAICollapsed] = useState(false);
            const [donateTab, setDonateTab] = useState('bsc');
            
            const donationAddresses = { bsc: "0xd99fe03da62cc568decaf4d5d97625f179652840", sol: "Esp38U7W4D1khAGKPQLvmLqdRU39GhcSyGgaeZvnwTpL" };
            const currentAddress = donationAddresses[donateTab];

            const [apiKeys, setApiKeys] = useState(() => {
                const savedKeys = safeJSONParse('gemini_api_keys', null);
                if (savedKeys) return savedKeys;
                const legacyKey = localStorage.getItem('gemini_api_key');
                return legacyKey ? [legacyKey, '', ''] : ['', '', ''];
            });
            const [tempKeys, setTempKeys] = useState(['', '', '']); 

            const [coinPrice, setCoinPrice] = useState(0); 
            const [priceChange, setPriceChange] = useState(0); 
            const [isLivePrice, setIsLivePrice] = useState(false);

            useEffect(() => {
                const savedData = safeJSONParse(`night_data_${currentComp.id}`, null);
                if (savedData) { setDataList(savedData); } else { setDataList(initialDataMap[currentComp.id] || []); }
                setAiStrategy(null); setError(null); setCoinPrice(0); setPriceChange(0); setIsLivePrice(false);
            }, [currentComp.id]); 
            
            const parseISOToUTC8 = (isoString) => {
                if (!isoString) return { date: '', hour: '00', minute: '00' };
                const date = new Date(isoString);
                if (isNaN(date.getTime())) return { date: '', hour: '00', minute: '00' };
                const utc8Date = new Date(date.getTime() + 28800000);
                const iso = utc8Date.toISOString(); 
                const [d, tPart] = iso.split('T');
                const [h, m] = tPart.split(':');
                return { date: d, hour: h, minute: m };
            };

            useEffect(() => {
                const startData = parseISOToUTC8(currentComp.startDate);
                setManualStartDate(startData.date); setManualStartHour(startData.hour); setManualStartMinute(startData.minute);
                const endData = parseISOToUTC8(currentComp.endDate);
                setManualEndDate(endData.date); setManualEndHour(endData.hour); setManualEndMinute(endData.minute);
            }, [currentComp]);

            const persistData = (newData) => {
                setDataList(newData);
                localStorage.setItem(`night_data_${currentComp.id}`, JSON.stringify(newData));
            };

            useEffect(() => {
                let isMounted = true;
                const fetchPrice = async () => {
                    if (!currentComp.coingeckoId) return;
                    try {
                        const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${currentComp.coingeckoId}&vs_currencies=usd&include_24hr_change=true`);
                        if (response.ok) {
                            const data = await response.json();
                            if (isMounted && data[currentComp.coingeckoId] && data[currentComp.coingeckoId].usd) {
                                setCoinPrice(data[currentComp.coingeckoId].usd);
                                setPriceChange(data[currentComp.coingeckoId].usd_24h_change || 0); 
                                setIsLivePrice(true);
                            } else { throw new Error("No price data found"); }
                        } else { if (isMounted) setIsLivePrice(false); throw new Error("API Limit"); }
                    } catch (e) {
                        if (isMounted) {
                            setCoinPrice(prev => { if (prev === 0) return 0.0001; const change = prev * (Math.random() * 0.01 - 0.005); return Math.max(0.00000001, prev + change); });
                            setPriceChange(prev => prev + (Math.random() * 0.5 - 0.25)); 
                            setIsLivePrice(false);
                        }
                    }
                };
                fetchPrice();
                const interval = setInterval(fetchPrice, 15000);
                return () => { isMounted = false; clearInterval(interval); };
            }, [currentComp.coingeckoId]);

            const chartData = useMemo(() => {
                return [...dataList].sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp)).map((item, index) => ({ ...item, displayDay: `${t.day} ${index + 1}`, userVolume: item.userVolume || 0 }));
            }, [dataList, t.day]);

            const stats = useMemo(() => {
                if (chartData.length < 1) return { current: 0, growthRate: 0, predictedNext: 0, maxVolume: 0, latestReward: 0, latestUserVolume: 0, latestEligibility: 0 };
                const current = chartData[chartData.length - 1].volume;
                const previous = chartData[chartData.length - 2]?.volume || current;
                const growthRate = previous === 0 ? 0 : ((current - previous) / previous) * 100;
                const reversedData = [...chartData].reverse();
                const latestRewardItem = reversedData.find(item => item.reward !== undefined && item.reward !== null && !isNaN(item.reward));
                const latestReward = latestRewardItem ? latestRewardItem.reward : 0;
                const latestEligibilityItem = reversedData.find(item => item.eligibility !== undefined && item.eligibility !== null);
                const latestEligibility = latestEligibilityItem ? latestEligibilityItem.eligibility : 0;
                const latestUserVolume = chartData[chartData.length - 1]?.userVolume || 0;
                return { current, growthRate, predictedNext: current * (1 + (growthRate / 100)), maxVolume: Math.max(...chartData.map(d => d.volume)), latestReward, latestUserVolume, latestEligibility };
            }, [chartData]);

            const handleDragStart = (e, index) => { setDraggedItem(index); e.dataTransfer.effectAllowed = 'move'; };
            const handleDragOver = (e) => { e.preventDefault(); };
            const handleDragEnter = (e, targetIndex) => {
                if (draggedItem === null || draggedItem === targetIndex) return;
                const newOrder = [...cardOrder];
                const draggedCardType = newOrder[draggedItem];
                newOrder.splice(draggedItem, 1);
                newOrder.splice(targetIndex, 0, draggedCardType);
                setCardOrder(newOrder);
                setDraggedItem(targetIndex); 
            };
            const handleDrop = (e) => { e.preventDefault(); localStorage.setItem('card_order', JSON.stringify(cardOrder)); setDraggedItem(null); };
            const handleDragEnd = () => { setDraggedItem(null); };

            const handleExportData = () => {
                const dataToExport = {
                    competitions: competitions,
                    apiKeys: apiKeys,
                    dataLists: competitions.reduce((acc, comp) => { const compData = localStorage.getItem(`night_data_${comp.id}`); if (compData) { acc[comp.id] = JSON.parse(compData); } return acc; }, {})
                };
                const dataStr = JSON.stringify(dataToExport, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', `AlphaDash_Backup_${new Date().toISOString().split('T')[0]}.json`);
                linkElement.click();
            };

            const handleImportData = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                if (window.confirm(t.importConfirm)) {
                    const fileReader = new FileReader();
                    fileReader.readAsText(file, "UTF-8");
                    fileReader.onload = e => {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            if (importedData.competitions) { setCompetitions(importedData.competitions); localStorage.setItem('night_competitions', JSON.stringify(importedData.competitions)); }
                            if (importedData.apiKeys) { setApiKeys(importedData.apiKeys); localStorage.setItem('gemini_api_keys', JSON.stringify(importedData.apiKeys)); }
                            if (importedData.dataLists) {
                                Object.keys(importedData.dataLists).forEach(compId => { localStorage.setItem(`night_data_${compId}`, JSON.stringify(importedData.dataLists[compId])); });
                                if (importedData.dataLists[currentComp.id]) { setDataList(importedData.dataLists[currentComp.id]); }
                            }
                            alert(t.importSuccess); setShowSettingsModal(false);
                        } catch (err) { setError("Import Failed: Invalid JSON file."); }
                    };
                }
                event.target.value = null; 
            };

            const renderCard = (type) => {
                switch(type) {
                    case 'reward': return <RewardCard stats={stats} coinPrice={coinPrice} currentComp={currentComp} t={t} />;
                    case 'countdown': return <CountdownCard startDate={currentComp.startDate} endDate={currentComp.endDate} symbol={currentComp.symbol} t={t} />;
                    case 'prediction': return <PredictionCard stats={stats} t={t} />;
                    case 'threshold': return <ThresholdCard stats={stats} t={t} />;
                    case 'growth': return <PriceCard coinPrice={coinPrice} priceChange={priceChange} currentComp={currentComp} t={t} />;
                    default: return null;
                }
            };

            const handleOpenManualEntry = () => {
                setEditingItem(null);
                setManualReward(stats.latestReward || ''); 
                setManualEligibility(stats.latestEligibility || ''); 
                setManualVolume(''); 
                setManualUserVolume(''); 
                setManualCost(''); 
                setManualDate(new Date().toISOString().split('T')[0]);
                
                const startData = parseISOToUTC8(currentComp.startDate); setManualStartDate(startData.date); setManualStartHour(startData.hour); setManualStartMinute(startData.minute);
                const endData = parseISOToUTC8(currentComp.endDate); setManualEndDate(endData.date); setManualEndHour(endData.hour); setManualEndMinute(endData.minute);
                
                setShowPeriodInputs(dataList.length === 0);
                setShowManualModal(true);
            };

            const handleEditItem = (item) => {
                setEditingItem(item);
                setManualVolume(item.volume);
                setManualUserVolume(item.userVolume);
                setManualCost(item.cost || '');
                setManualReward(item.reward);
                setManualEligibility(item.eligibility);
                
                const datePart = new Date(item.timestamp).toISOString().split('T')[0];
                setManualDate(datePart);

                const startData = parseISOToUTC8(currentComp.startDate); setManualStartDate(startData.date); setManualStartHour(startData.hour); setManualStartMinute(startData.minute);
                const endData = parseISOToUTC8(currentComp.endDate); setManualEndDate(endData.date); setManualEndHour(endData.hour); setManualEndMinute(endData.minute);

                setShowPeriodInputs(false);
                setShowManualModal(true);
            };

            const handleManualSubmit = () => {
                if (!manualVolume || isNaN(parseFloat(manualVolume))) return;
                
                const commonData = {
                    volume: parseFloat(manualVolume),
                    userVolume: manualUserVolume ? parseFloat(manualUserVolume) : 0,
                    cost: manualCost ? parseFloat(manualCost) : 0,
                    reward: manualReward ? parseFloat(manualReward) : (stats.latestReward || 0),
                    eligibility: manualEligibility ? parseInt(manualEligibility) : (stats.latestEligibility || 0),
                    timestamp: new Date(manualDate).toISOString(),
                };

                let newData;

                if (editingItem) {
                    newData = dataList.map(item => 
                        item.id === editingItem.id 
                            ? { ...item, ...commonData } 
                            : item
                    );
                } else {
                    const newEntry = {
                        id: Date.now(),
                        ...commonData,
                        source: 'manual'
                    };
                    newData = [...dataList, newEntry];
                }
                
                updateCompetitionPeriod(manualStartDate, manualStartHour, manualStartMinute, manualEndDate, manualEndHour, manualEndMinute);

                persistData(newData);
                setShowManualModal(false);
                setEditingItem(null);
            };

            const openManageModal = (comp = null) => {
                if (comp) {
                    setEditingComp(comp);
                    const startData = parseISOToUTC8(comp.startDate);
                    const endData = parseISOToUTC8(comp.endDate);
                    setCompForm({ 
                        name: comp.name, 
                        symbol: comp.symbol, 
                        coingeckoId: comp.coingeckoId, 
                        color: comp.color, 
                        startDate: startData.date, 
                        startHour: startData.hour, 
                        startMinute: startData.minute, 
                        endDate: endData.date, 
                        endHour: endData.hour, 
                        endMinute: endData.minute,
                        reward: comp.reward || '',
                        eligibility: comp.eligibility || ''
                    });
                } else {
                    setEditingComp(null);
                    setCompForm({ 
                        name: '', 
                        symbol: '', 
                        coingeckoId: '', 
                        color: 'indigo', 
                        startDate: '', 
                        startHour: '00', 
                        startMinute: '00', 
                        endDate: '', 
                        endHour: '00', 
                        endMinute: '00',
                        reward: '',
                        eligibility: ''
                    });
                }
                setShowManageModal(true);
            };

            const handleSaveCompetition = () => {
                if (!compForm.name || !compForm.symbol) return;
                
                let finalCgId = compForm.coingeckoId.trim();
                if (finalCgId.includes('coingecko.com/')) {
                    try {
                        if (finalCgId.includes('/coins/')) {
                            const parts = finalCgId.split('/coins/');
                            if (parts[1]) {
                                finalCgId = parts[1].split(/[/?#]/)[0];
                            }
                        }
                    } catch (e) {}
                }

                const selectedColor = colorOptions.find(c => c.id === compForm.color);
                const constructDate = (d, h, m) => { if (!d) return null; const isoLocal = `${d}T${h}:${m}:00+08:00`; return new Date(isoLocal).toISOString(); };
                const newComp = {
                    id: editingComp ? editingComp.id : `custom-${Date.now()}`, name: compForm.name, symbol: compForm.symbol, 
                    coingeckoId: finalCgId, 
                    color: compForm.color, icon: selectedColor.icon, gradient: selectedColor.gradient,
                    startDate: compForm.startDate ? constructDate(compForm.startDate, compForm.startHour, compForm.startMinute) : (editingComp ? editingComp.startDate : null),
                    endDate: compForm.endDate ? constructDate(compForm.endDate, compForm.endHour, compForm.endMinute) : (editingComp ? editingComp.endDate : null),
                    reward: compForm.reward ? parseFloat(compForm.reward) : 0,
                    eligibility: compForm.eligibility ? parseInt(compForm.eligibility) : 0
                };
                if (editingComp) { setCompetitions(prev => prev.map(c => c.id === editingComp.id ? newComp : c)); if (currentComp.id === editingComp.id) setCurrentComp(newComp); } else { setCompetitions(prev => [...prev, newComp]); }
                setShowManageModal(false);
            };

            const handleDeleteRequest = (id, e) => { e.stopPropagation(); setDeleteTargetId(id); setShowDeleteModal(true); };
            const confirmDeleteCompetition = () => { if (!deleteTargetId) return; const newComps = competitions.filter(c => c.id !== deleteTargetId); setCompetitions(newComps); localStorage.removeItem(`night_data_${deleteTargetId}`); if (currentComp.id === deleteTargetId && newComps.length > 0) { setCurrentComp(newComps[0]); } setShowDeleteModal(false); setDeleteTargetId(null); };
            const confirmSaveKey = () => { setApiKeys(tempKeys); localStorage.setItem('gemini_api_keys', JSON.stringify(tempKeys)); localStorage.removeItem('gemini_api_key'); setShowSettingsModal(false); setError(null); };
            const clearKey = () => { setTempKeys(['', '', '']); };
            const openSettingsModal = () => { setTempKeys(apiKeys); setShowSettingsModal(true); };

            const fetchWithRetry = async (url, options, retryCount = 0) => {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) { const errBody = await response.json().catch(() => ({})); throw new Error(errBody.error?.message || `HTTP ${response.status}`); }
                    return await response.json();
                } catch (err) {
                    if (err.message.includes('400') || err.message.includes('403') || err.message.includes('API key')) { throw err; }
                    if (retryCount < 5) { const delay = Math.pow(2, retryCount) * 1000; await new Promise(r => setTimeout(r, delay)); return fetchWithRetry(url, options, retryCount + 1); }
                    throw err;
                }
            };
            
            const callGeminiAPI = async (payload) => {
                const validKeys = apiKeys.filter(k => k && k.trim() !== '');
                if (validKeys.length === 0) throw new Error(t.errorApiKey);
                let lastError = null;
                for (const key of validKeys) {
                    try {
                        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${key}`;
                        return await fetchWithRetry(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    } catch (error) { console.warn("API Key failed, trying next...", error); lastError = error; }
                }
                throw lastError || new Error("All API keys failed.");
            };

            const handleFileUpload = async (event) => {
                const files = Array.from(event.target.files);
                if (files.length === 0) return;
                
                const hasKeys = apiKeys.some(k => k && k.trim() !== '');
                if (!hasKeys) { setError(t.errorApiKey); openSettingsModal(); event.target.value = null; return; }
                
                setIsAnalyzing(true); 
                setError(null);
                
                try {
                    // Process all images to base64
                    const imageParts = await Promise.all(files.map(async (file) => {
                        const base64 = await new Promise((resolve, reject) => { 
                            const reader = new FileReader(); 
                            reader.onload = () => resolve(reader.result.split(',')[1]); 
                            reader.onerror = reject; 
                            reader.readAsDataURL(file); 
                        });
                        return { inlineData: { mimeType: file.type, data: base64 } };
                    }));

                    const promptText = `Analyze the provided trading competition leaderboard screenshot(s). Extract data for each distinct snapshot found.
                    Return a JSON ARRAY containing objects with these fields:
                    - volume: (Number, required) The threshold volume to enter the leaderboard.
                    - userVolume: (Number, optional) The user's current volume.
                    - reward: (Number, optional) The reward amount shown.
                    - eligibility: (Number, optional) The rank limit (e.g. 20000).
                    - dataCutoff: (String, ISO format, optional) The timestamp of the data. Use current time if not visible.
                    - promotionStart: (String, ISO format, optional) Start date of competition.
                    - promotionEnd: (String, ISO format, optional) End date of competition.
                    
                    Strictly output ONLY the JSON array.`;

                    const result = await callGeminiAPI({ 
                        contents: [{ 
                            parts: [ { text: promptText }, ...imageParts ] 
                        }] 
                    });

                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (!text) throw new Error(t.errorRecognize);

                    const jsonStr = text.replace(/```json/g, '').replace(/```/g, '').trim();
                    let parsedArray = [];

                    try { 
                        // Try parsing as array first
                        if (jsonStr.startsWith('[') && jsonStr.endsWith(']')) {
                            parsedArray = JSON.parse(jsonStr);
                        } else {
                            // Try finding array within text
                            const firstBracket = jsonStr.indexOf('[');
                            const lastBracket = jsonStr.lastIndexOf(']');
                            if (firstBracket !== -1 && lastBracket !== -1) {
                                parsedArray = JSON.parse(jsonStr.substring(firstBracket, lastBracket + 1));
                            } else {
                                // Try finding single object
                                const firstBrace = jsonStr.indexOf('{');
                                const lastBrace = jsonStr.lastIndexOf('}');
                                if (firstBrace !== -1 && lastBrace !== -1) {
                                    parsedArray = [JSON.parse(jsonStr.substring(firstBrace, lastBrace + 1))];
                                } else {
                                     // Last resort: simple number extraction
                                     const val = parseFloat(text.trim().replace(/[^0-9.]/g, ''));
                                     if (!isNaN(val)) parsedArray = [{ volume: val }];
                                }
                            }
                        }
                    } catch (e) { 
                        console.error("JSON Parse Error", e);
                        throw new Error(t.errorRecognize);
                    }

                    if (parsedArray && parsedArray.length > 0) {
                        let currentList = [...dataList];
                        let addedCount = 0;

                        // Check for competition period updates from the first valid entry
                        const periodInfo = parsedArray.find(p => p.promotionStart || p.promotionEnd);
                        if (periodInfo) {
                             const updatedComp = { ...currentComp, startDate: periodInfo.promotionStart || currentComp.startDate, endDate: periodInfo.promotionEnd || currentComp.endDate };
                             setCompetitions(prev => prev.map(c => c.id === currentComp.id ? updatedComp : c)); 
                             setCurrentComp(updatedComp);
                        }

                        parsedArray.forEach((data, index) => {
                            if (!isNaN(data.volume) && data.volume > 0) {
                                let timestamp = new Date().toISOString();
                                if (data.dataCutoff) { 
                                    const parsedTime = new Date(data.dataCutoff); 
                                    if (!isNaN(parsedTime.getTime())) { timestamp = parsedTime.toISOString(); } 
                                }
                                
                                // Avoid exact duplicates based on timestamp + volume (simple check)
                                const isDuplicate = currentList.some(item => 
                                    Math.abs(item.volume - data.volume) < 0.01 && 
                                    Math.abs(new Date(item.timestamp) - new Date(timestamp)) < 60000 // within 1 min
                                );

                                if (!isDuplicate) {
                                    currentList.push({ 
                                        id: Date.now() + index, // Ensure unique ID
                                        volume: data.volume, 
                                        userVolume: data.userVolume || 0, 
                                        cost: 0, // AI usually doesn't get cost
                                        reward: data.reward || (stats.latestReward || 0), 
                                        eligibility: data.eligibility || (stats.latestEligibility || 0), 
                                        timestamp: timestamp, 
                                        source: 'ai' 
                                    });
                                    addedCount++;
                                }
                            }
                        });

                        if (addedCount > 0) {
                            persistData(currentList);
                        } else {
                            if (parsedArray.length === 0) throw new Error("No valid data found.");
                        }
                    } else { 
                        throw new Error(t.errorValid); 
                    }
                } catch (e) { 
                    setError(e.message); 
                } finally { 
                    setIsAnalyzing(false); 
                    event.target.value = null; 
                }
            };

            const generateAIStrategy = async () => {
                if (chartData.length < 2) { setError(t.errorTrend); return; }
                const hasKeys = apiKeys.some(k => k && k.trim() !== '');
                if (!hasKeys) { setError(t.errorApiKey); openSettingsModal(); return; }
                setIsGeneratingStrategy(true); setError(null);
                try {
                    const dataStr = chartData.map(d => `${d.displayDay}: Threshold $${d.volume}, My Volume $${d.userVolume}`).join(', ');
                    const prompt = `${t.promptStrategy}\n\nDataset:\n${dataStr}`;
                    
                    const result = await callGeminiAPI({ 
                        contents: [{ parts: [{ text: prompt }] }], 
                        generationConfig: { 
                            responseMimeType: "application/json", 
                            responseSchema: { 
                                type: "object", 
                                properties: { 
                                    marketPhase: { type: "string" }, 
                                    riskLevel: { type: "string" }, 
                                    analysis: { type: "string" }, 
                                    actionableAdvice: { type: "array", items: { type: "string" } }, 
                                    psychologicalTip: { type: "string" } 
                                }, 
                                required: ["marketPhase", "riskLevel", "analysis", "actionableAdvice", "psychologicalTip"] 
                            } 
                        } 
                    });
                    const strategyText = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (strategyText) { setAiStrategy(JSON.parse(strategyText)); setIsAICollapsed(false); }
                } catch (e) { setError(e.message); } finally { setIsGeneratingStrategy(false); }
            };
            
            const updateCompetitionPeriod = (startDateStr, startHour, startMinute, endDateStr, endHour, endMinute) => {
                if (!startDateStr && !endDateStr) return;
                const constructDate = (d, h, m) => { if (!d) return null; const isoLocal = `${d}T${h}:${m}:00+08:00`; return new Date(isoLocal).toISOString(); };
                const startISO = constructDate(startDateStr, startHour, startMinute);
                const endISO = constructDate(endDateStr, endHour, endMinute);
                const updatedComp = { ...currentComp, startDate: startISO || currentComp.startDate, endDate: endISO || currentComp.endDate };
                setCompetitions(prev => prev.map(c => c.id === currentComp.id ? updatedComp : c)); setCurrentComp(updatedComp);
            };

            const hours = Array.from({length: 24}, (_, i) => i.toString().padStart(2, '0'));
            const minutes = ['00', '15', '30', '45'];

            const copyText = (text) => {
                const textarea = document.createElement('textarea'); textarea.value = text; document.body.appendChild(textarea); textarea.select(); document.execCommand('copy'); document.body.removeChild(textarea);
            };

            const formatTimeDisplay = (isoString) => {
                if(!isoString) return '--';
                try {
                    const d = new Date(isoString);
                    if(isNaN(d.getTime())) return '--';
                    const pad = (n) => n.toString().padStart(2, '0');
                    return `${d.getFullYear()}/${pad(d.getMonth()+1)}/${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
                } catch(e) { return '--'; }
            };

            return (
                <div className="min-h-screen bg-slate-50 dark:bg-black text-slate-900 dark:text-slate-200 selection:bg-blue-500/30 transition-colors duration-300 p-2 md:p-4 relative">
                    <div className="fixed inset-0 z-0 pointer-events-none overflow-hidden">
                        <div className="absolute inset-0 bg-grid-black/[0.02] dark:bg-grid-white/[0.02] bg-[size:20px_20px]"></div>
                        <div className="absolute inset-0 bg-grid-black/[0.06] dark:bg-grid-white/[0.05] bg-[size:100px_100px]"></div>
                        <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,transparent_0%,rgba(255,255,255,0.8)_100%)] dark:bg-[radial-gradient(circle_at_center,transparent_0%,rgba(0,0,0,0.8)_100%)]"></div>
                        <div className="absolute top-0 -left-4 w-96 h-96 bg-indigo-500/20 rounded-full mix-blend-multiply filter blur-[100px] animate-blob"></div>
                        <div className="absolute top-0 -right-4 w-96 h-96 bg-purple-500/20 rounded-full mix-blend-multiply filter blur-[100px] animate-blob animation-delay-2000"></div>
                        <div className="absolute -bottom-8 left-20 w-96 h-96 bg-blue-500/20 rounded-full mix-blend-multiply filter blur-[100px] animate-blob animation-delay-4000"></div>
                    </div>

                    <div className="max-w-6xl mx-auto flex-1 w-full relative z-10">
                        {/* Header */}
                        <header className="flex flex-col md:flex-row justify-between mb-4 md:mb-6 gap-2 md:gap-6 items-start md:items-center">
                            <div className="flex w-full md:w-auto flex-col gap-0.5 md:gap-1">
                                <div className="flex items-center justify-between md:justify-start gap-4">
                                    <div className="flex items-center gap-2 animate-in fade-in slide-in-from-left-2">
                                        <svg viewBox="0 0 24 24" className="w-5 h-5 text-[#F0B90B]" fill="currentColor"><path d="M12 0L9.56 2.44L12 4.88L14.44 2.44L12 0ZM4.88 7.12L2.44 9.56L0 12L2.44 14.44L4.88 16.88L7.32 14.44L4.88 12L7.32 9.56L4.88 7.12ZM19.12 7.12L16.68 9.56L19.12 12L16.68 14.44L19.12 16.88L21.56 14.44L24 12L21.56 9.56L19.12 7.12ZM12 9.12L9.12 12L12 14.88L14.88 12L12 9.12ZM12 19.12L9.56 21.56L12 24L14.44 21.56L12 19.12Z" /></svg>
                                        <div className="text-xs md:text-sm uppercase tracking-widest text-slate-500 dark:text-slate-400 leading-none flex items-baseline gap-1.5 whitespace-nowrap"><span className="font-black text-slate-900 dark:text-white">Alpha</span><span className="font-light opacity-80">Trading Competition</span></div>
                                    </div>
                                    
                                    {/* Mobile Controls */}
                                    <div className="md:hidden flex items-center h-10 bg-white dark:bg-slate-800/50 rounded-xl p-1 border border-slate-200 dark:border-slate-700/50 backdrop-blur-md shadow-lg box-border relative z-50">
                                        <div className="relative h-full">
                                            <button 
                                                onClick={() => setShowLangMenu(!showLangMenu)}
                                                className="h-full px-2 rounded-lg text-slate-500 dark:text-slate-400 hover:text-indigo-500 dark:hover:text-indigo-400 hover:bg-slate-100 dark:hover:bg-slate-700/50 transition-all flex items-center gap-1"
                                            >
                                                <span className="text-xs font-bold">{lang === 'zh' ? 'CN' : 'EN'}</span>
                                                <Icon name="chevron-down" size={10} className={`transition-transform duration-200 ${showLangMenu ? 'rotate-180' : ''}`} />
                                            </button>
                                            
                                            {showLangMenu && (
                                                <>
                                                    <div className="fixed inset-0 z-10" onClick={() => setShowLangMenu(false)}></div>
                                                    <div className="absolute top-full left-0 mt-2 w-28 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-200 dark:border-slate-700 overflow-hidden z-20 animate-in fade-in zoom-in-95 duration-200 flex flex-col p-1">
                                                        <button onClick={() => { setLang('zh'); setShowLangMenu(false); }} className={`w-full px-3 py-2 rounded-lg text-xs font-bold text-left hover:bg-slate-50 dark:hover:bg-slate-700 flex items-center gap-2 ${lang === 'zh' ? 'bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-300' : 'text-slate-600 dark:text-slate-300'}`}>
                                                            <span className="text-base">🇨🇳</span> 中文
                                                        </button>
                                                        <button onClick={() => { setLang('en'); setShowLangMenu(false); }} className={`w-full px-3 py-2 rounded-lg text-xs font-bold text-left hover:bg-slate-50 dark:hover:bg-slate-700 flex items-center gap-2 ${lang === 'en' ? 'bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-300' : 'text-slate-600 dark:text-slate-300'}`}>
                                                            <span className="text-base">🇺🇸</span> English
                                                        </button>
                                                    </div>
                                                </>
                                            )}
                                        </div>
                                        <div className="w-[1px] h-5 bg-slate-200 dark:bg-slate-700 mx-1"></div>
                                        <button onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')} className="h-full px-3 rounded-lg text-slate-500 dark:text-slate-400 hover:text-amber-500 dark:hover:text-yellow-400 hover:bg-slate-100 dark:hover:bg-slate-700/50 transition-all flex items-center justify-center"><Icon name={theme === 'dark' ? 'moon' : 'sun'} size={16} className={theme === 'dark' ? 'text-indigo-400' : 'text-amber-500'} /></button>
                                        <div className="w-[1px] h-5 bg-slate-200 dark:bg-slate-700 mx-1"></div>
                                        <button onClick={openSettingsModal} className="h-full px-3 rounded-lg text-slate-500 dark:text-slate-400 hover:text-blue-500 dark:hover:text-blue-400 hover:bg-slate-100 dark:hover:bg-slate-700/50 transition-all flex items-center justify-center"><Icon name="settings" size={16} /></button>
                                    </div>
                                </div>
                                <div className="flex flex-wrap items-center gap-4">
                                    <button onClick={() => setShowCompModal(true)} className="text-2xl md:text-3xl font-black flex items-center gap-3 text-slate-800 dark:text-white tracking-tight hover:opacity-80 transition-opacity group" title={t.switchCompetition}>
                                        <div className="relative"><div className={`w-3 h-3 rounded-full animate-pulse relative z-10 bg-${currentComp.color}-500`} /><div className={`absolute inset-0 rounded-full blur-sm opacity-50 animate-pulse bg-${currentComp.color}-500`} /></div>
                                        {currentComp.symbol} <span className="text-slate-400 font-light group-hover:text-slate-500 dark:group-hover:text-slate-400 transition-colors text-lg md:text-2xl">DASHBOARD</span>
                                        <Icon name="chevron-down" size={24} className="text-slate-400 group-hover:text-slate-500 dark:text-slate-600 dark:group-hover:text-slate-400 transition-colors" />
                                    </button>
                                </div>
                            </div>
                            <div className="flex gap-3 w-full md:w-auto justify-between md:justify-end items-center">
                                <div className="hidden md:flex items-center h-12 bg-white dark:bg-slate-800/50 rounded-xl p-1 border border-slate-200 dark:border-slate-700/50 backdrop-blur-md shadow-lg box-border relative z-50">
                                    <div className="relative h-full">
                                        <button 
                                            onClick={() => setShowLangMenu(!showLangMenu)}
                                            className="h-full px-3 rounded-lg text-slate-500 dark:text-slate-400 hover:text-indigo-500 dark:hover:text-indigo-400 hover:bg-slate-100 dark:hover:bg-slate-700/50 transition-all flex items-center gap-2"
                                        >
                                            <Icon name="languages" size={16} />
                                            <span className="text-xs font-bold">{lang === 'zh' ? 'CN' : 'EN'}</span>
                                            <Icon name="chevron-down" size={12} className={`transition-transform duration-200 ${showLangMenu ? 'rotate-180' : ''}`} />
                                        </button>
                                        
                                        {showLangMenu && (
                                            <>
                                                <div className="fixed inset-0 z-10" onClick={() => setShowLangMenu(false)}></div>
                                                <div className="absolute top-full right-0 mt-2 w-32 bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-200 dark:border-slate-700 overflow-hidden z-20 animate-in fade-in zoom-in-95 duration-200 flex flex-col p-1">
                                                    <button onClick={() => { setLang('zh'); setShowLangMenu(false); }} className={`w-full px-3 py-2 rounded-lg text-xs font-bold text-left hover:bg-slate-50 dark:hover:bg-slate-700 flex items-center gap-2 ${lang === 'zh' ? 'bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-300' : 'text-slate-600 dark:text-slate-300'}`}>
                                                        <span className="text-base">🇨🇳</span> 中文
                                                    </button>
                                                    <button onClick={() => { setLang('en'); setShowLangMenu(false); }} className={`w-full px-3 py-2 rounded-lg text-xs font-bold text-left hover:bg-slate-50 dark:hover:bg-slate-700 flex items-center gap-2 ${lang === 'en' ? 'bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-300' : 'text-slate-600 dark:text-slate-300'}`}>
                                                        <span className="text-base">🇺🇸</span> English
                                                    </button>
                                                </div>
                                            </>
                                        )}
                                    </div>

                                    <div className="w-[1px] h-6 bg-slate-200 dark:bg-slate-700 mx-1"></div>
                                    <button onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')} className="h-full px-3 rounded-lg text-slate-500 dark:text-slate-400 hover:text-amber-500 dark:hover:text-yellow-400 hover:bg-slate-100 dark:hover:bg-slate-700/50 transition-all flex items-center justify-center"><Icon name={theme === 'dark' ? 'moon' : 'sun'} size={16} className={theme === 'dark' ? 'text-indigo-400' : 'text-amber-500'} /></button>
                                    <div className="w-[1px] h-6 bg-slate-200 dark:bg-slate-700 mx-1"></div>
                                    <button onClick={openSettingsModal} className="h-full px-3 rounded-lg text-slate-500 dark:text-slate-400 hover:text-blue-500 dark:hover:text-blue-400 hover:bg-slate-100 dark:hover:bg-slate-700/50 transition-all flex items-center justify-center"><Icon name="settings" size={16} /></button>
                                </div>
                            </div>
                        </header>

                        {error && (
                            <div className="mb-6 p-4 bg-rose-50 dark:bg-rose-500/10 border border-rose-200 dark:border-rose-500/20 text-rose-600 dark:text-rose-400 rounded-2xl flex justify-between items-center animate-in fade-in slide-in-from-top-2 shadow-sm dark:shadow-[0_0_30px_-10px_rgba(244,63,94,0.2)]">
                                <div className="flex items-center gap-3 text-sm font-bold"><Icon name="alert-triangle" /> {error}</div>
                                <button onClick={() => setError(null)} className="p-1 hover:bg-rose-100 dark:hover:bg-rose-500/20 rounded-lg transition-colors"><Icon name="x" size={18} /></button>
                            </div>
                        )}

                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3 md:gap-4 mb-8">
                            {cardOrder.map((type, index) => (
                                <div key={type} draggable onDragStart={(e) => handleDragStart(e, index)} onDragOver={handleDragOver} onDragEnter={(e) => handleDragEnter(e, index)} onDrop={handleDrop} onDragEnd={handleDragEnd} className={`draggable-card transition-all duration-300 ${draggedItem === index ? 'dragging' : ''}`} title="Drag to reorder">
                                    {renderCard(type)}
                                </div>
                            ))}
                        </div>

                        {/* Main Grid: Left Col (Status + History) & Right Col (Chart) */}
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8">
                            {/* Left Column */}
                            <div className="lg:col-span-1 flex flex-col gap-6">
                                {/* Status Card */}
                                <div className={`glass-panel p-4 md:p-6 rounded-3xl border relative overflow-hidden transition-all duration-500 bg-white dark:bg-slate-900/60 backdrop-blur-md group hover:-translate-y-1 hover:scale-[1.02] shadow-sm hover:shadow-xl dark:shadow-lg border-indigo-200 dark:border-indigo-500/30 ${stats.latestUserVolume >= stats.current ? 'shadow-emerald-500/10 dark:shadow-emerald-900/30' : 'shadow-rose-500/10 dark:shadow-rose-900/30'}`}>
                                    <div className="absolute inset-0 pointer-events-none z-0 overflow-hidden rounded-3xl"><div className={`absolute inset-0 h-full w-full bg-gradient-to-r from-transparent ${stats.latestUserVolume >= stats.current ? 'via-emerald-400/10' : 'via-rose-400/10'} to-transparent animate-shimmer`} style={{willChange: 'transform'}}></div></div>
                                    <div className={`absolute -right-6 -top-6 w-32 h-32 rounded-full blur-3xl opacity-20 dark:opacity-30 transition-colors duration-500 animate-pulse ${stats.latestUserVolume >= stats.current ? 'bg-emerald-500' : 'bg-rose-500'}`}></div>
                                    <div className={`absolute -right-4 -top-4 opacity-[0.05] group-hover:opacity-[0.1] transition-all duration-500 transform group-hover:scale-110 group-hover:rotate-12 pointer-events-none ${stats.latestUserVolume >= stats.current ? 'text-emerald-500 dark:text-emerald-400' : 'text-rose-500 dark:text-rose-400'}`}><Icon name={stats.latestUserVolume >= stats.current ? "shield-check" : "alert-octagon"} size={120} /></div>
                                    <div className="flex items-center gap-3 mb-4 relative z-10">
                                        <div className="relative">
                                            <div className={`absolute inset-0 rounded-xl animate-pulse-ring ${stats.latestUserVolume >= stats.current ? 'bg-emerald-500' : 'bg-rose-500'}`}></div>
                                            <div className={`relative w-8 h-8 rounded-xl border flex items-center justify-center transition-colors duration-300 shadow-lg ${stats.latestUserVolume >= stats.current ? 'bg-emerald-100 dark:bg-emerald-500/20 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-500/30' : 'bg-rose-100 dark:bg-rose-500/20 text-rose-600 dark:text-rose-400 border-rose-200 dark:border-rose-500/30'}`}><Icon name={stats.latestUserVolume >= stats.current ? "shield-check" : "alert-octagon"} size={18} /></div>
                                        </div>
                                        <div className="text-slate-500 dark:text-slate-400 text-xs font-bold uppercase tracking-widest flex items-center gap-2">{t.statusTitle}<span className={`flex w-2 h-2 rounded-full ${stats.latestUserVolume >= stats.current ? 'bg-emerald-500 animate-ping' : 'bg-rose-500 animate-pulse'}`}></span></div>
                                    </div>
                                    <div className="flex justify-between items-end mb-4 relative z-10">
                                        <div>
                                            <div className="flex items-baseline gap-1">
                                                <span className={`text-4xl font-black tracking-tight drop-shadow-sm text-slate-900 dark:text-white`}>
                                                    {stats.latestUserVolume >= stats.current ? '+' : ''}
                                                    {stats.current > 0 ? ((stats.latestUserVolume - stats.current) / stats.current * 100).toFixed(2) : 0}
                                                </span>
                                                <span className={`text-xl font-bold text-slate-900 dark:text-white/80`}>%</span>
                                            </div>
                                            <div className={`text-xs font-bold mt-1 ${stats.latestUserVolume >= stats.current ? 'text-emerald-600/80 dark:text-emerald-500/80' : 'text-rose-600/80 dark:text-rose-500/80'}`}>{stats.latestUserVolume >= stats.current ? t.lead : t.lag}</div>
                                        </div>
                                        <div className="text-right"><div className="text-[10px] text-slate-400 dark:text-slate-500 font-bold mb-1 uppercase">{t.legendUser}</div><div className="text-lg font-rounded font-bold text-slate-800 dark:text-white tracking-tight">${stats.latestUserVolume.toLocaleString()}</div></div>
                                    </div>
                                    <div className="h-2 w-full bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden flex relative z-10 border border-slate-200 dark:border-slate-700/50"><div className={`h-full rounded-full transition-all duration-1000 animate-stripes shadow-[0_0_10px_rgba(0,0,0,0.1)] ${stats.latestUserVolume >= stats.current ? 'bg-emerald-500 w-full' : 'bg-rose-500 w-full'}`}></div></div>
                                </div>

                                {/* History Snapshot Card - Updated to match border style */}
                                <div className="relative rounded-3xl border border-indigo-200 dark:border-indigo-500/30 shadow-sm dark:shadow-lg transition-all duration-300 group flex flex-col max-h-[350px] lg:max-h-[600px] bg-white dark:bg-[#0f101f]/90 backdrop-blur-md overflow-hidden">
                                    <div className="absolute inset-0 bg-gradient-to-br from-indigo-100/50 dark:from-indigo-900/20 to-transparent opacity-50 pointer-events-none"></div>
                                    <div className="absolute -right-4 -top-4 opacity-30 group-hover:opacity-50 transition-all duration-500 transform group-hover:scale-110 group-active:scale-125 group-hover:-rotate-12 group-active:-rotate-12 pointer-events-none"><Icon name="history" size={120} className="text-violet-400 dark:text-violet-300" /></div>
                                    <div className="relative z-10 p-4 border-b border-indigo-100 dark:border-indigo-500/20 bg-white/50 dark:bg-slate-900/20 backdrop-blur-sm">
                                        <div className="flex justify-between items-center mb-2">
                                            <div className="flex items-center gap-3"><div className="relative"><div className="absolute inset-0 rounded-xl animate-pulse-ring bg-indigo-500"></div><div className="relative z-10 w-8 h-8 rounded-xl border flex items-center justify-center bg-indigo-100 dark:bg-indigo-500/10 text-indigo-600 dark:text-indigo-400 border-indigo-200 dark:border-indigo-500/20"><Icon name="list" size={18} /></div></div><div className="text-indigo-900/70 dark:text-indigo-200/70 text-xs font-bold uppercase tracking-widest">{t.historySnapshot}</div></div>
                                            <span className="bg-white/80 dark:bg-indigo-900/40 px-2 py-0.5 rounded-lg border border-indigo-200 dark:border-indigo-500/30 text-xs text-indigo-600 dark:text-indigo-300 font-rounded font-bold">{dataList.length}</span>
                                        </div>
                                        <div className="grid grid-cols-2 gap-2">
                                            <button onClick={handleOpenManualEntry} className="flex items-center justify-center gap-2 py-2 px-3 rounded-xl bg-slate-50 hover:bg-white dark:bg-slate-800/50 dark:hover:bg-slate-800 text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 text-xs font-bold transition-all border border-slate-200 dark:border-slate-700/50 active:scale-95 hover:-translate-y-0.5 hover:shadow-md group/btn">
                                                <Icon name="keyboard" size={14} className="group-hover/btn:scale-110 transition-transform" /> {t.manualEntry}
                                            </button>
                                            
                                            <label className={`relative overflow-hidden flex items-center justify-center gap-2 py-2 px-3 rounded-xl cursor-pointer transition-all duration-300 border active:scale-95 hover:-translate-y-0.5 group/btn shadow-sm ${isAnalyzing ? 'bg-slate-50 dark:bg-slate-900 border-slate-200 dark:border-slate-700 cursor-not-allowed' : 'bg-gradient-to-r from-violet-600 to-indigo-600 hover:from-violet-500 hover:to-indigo-500 border-transparent shadow-indigo-500/25 hover:shadow-indigo-500/40'}`}>
                                                {!isAnalyzing && (<div className="absolute inset-0 opacity-10 bg-[radial-gradient(#fff_1px,transparent_1px)] [background-size:8px_8px]"></div>)}
                                                {isAnalyzing && (<div className="absolute inset-0 z-0 pointer-events-none"><div className="absolute top-0 left-0 w-full h-full bg-indigo-500/5"></div></div>)}
                                                <div className={`relative z-10 flex items-center gap-2 ${isAnalyzing ? 'opacity-100' : ''}`}>
                                                    <Icon name={isAnalyzing ? "loader-2" : "scan-face"} size={14} className={isAnalyzing ? "text-indigo-500 dark:text-indigo-400 animate-spin" : "text-white"} />
                                                    <span className={`text-xs font-bold ${isAnalyzing ? 'animate-text-flow' : 'text-white'}`}>{isAnalyzing ? t.analyzing : t.importScreenshot}</span>
                                                </div>
                                                {!isAnalyzing && (<div className="absolute -inset-1 bg-gradient-to-r from-white/0 via-white/20 to-white/0 skew-x-12 translate-x-[-200%] group-hover/btn:animate-shimmer transition-all"></div>)}
                                                <input type="file" className="hidden" onChange={handleFileUpload} accept="image/*" multiple disabled={isAnalyzing} />
                                            </label>
                                        </div>
                                    </div>
                                    <div className="relative z-10 flex-1 overflow-y-auto p-1.5 space-y-1.5 custom-scrollbar">
                                        {chartData.slice().reverse().map((item, index) => {
                                            const gap = item.userVolume - item.volume;
                                            const isSafe = gap >= 0;
                                            const gapPercent = item.volume > 0 ? (gap / item.volume * 100) : 0;
                                            const isLatest = index === 0;

                                            let cardBaseStyle = '';
                                            let glowColor = '';
                                            let dayLabelColor = '';
                                            let dateLabelColor = '';
                                            let editBtnColor = '';
                                            let deleteBtnColor = '';
                                            let thresholdCardBg = '';
                                            let thresholdLabelColor = '';
                                            let thresholdValueColor = '';
                                            let userCardStyle = '';
                                            let userLabelColor = '';
                                            let userValueColor = '';
                                            let percentColor = '';
                                            let dotStyle = '';

                                            if (isLatest) {
                                                cardBaseStyle = 'bg-[#181a20] border-[#F0B90B] shadow-[0_0_15px_rgba(240,185,11,0.15)] hover:shadow-[0_0_20px_rgba(240,185,11,0.3)] hover:-translate-y-0.5';
                                                glowColor = 'bg-[#F0B90B]';
                                                dayLabelColor = 'text-[#F0B90B] opacity-90';
                                                dateLabelColor = 'text-white/90';
                                                editBtnColor = 'text-[#848E9C] hover:text-white hover:bg-[#2B3139]';
                                                deleteBtnColor = 'text-[#848E9C] hover:text-[#F6465D] hover:bg-[#2B3139]';
                                                thresholdCardBg = 'bg-[#2B3139] border border-[#474D57]';
                                                thresholdLabelColor = 'text-[#848E9C]';
                                                thresholdValueColor = 'text-[#EAECEF]';
                                                userCardStyle = 'bg-[#2B3139] border border-[#F0B90B]/50 relative overflow-hidden';
                                                userLabelColor = 'text-[#F0B90B]';
                                                userValueColor = 'text-white';
                                                percentColor = 'text-[#F0B90B]';
                                                dotStyle = 'bg-[#F0B90B] shadow-[0_0_8px_rgba(240,185,11,0.8)]';
                                            } else {
                                                cardBaseStyle = isSafe ? 'bg-indigo-50/40 dark:bg-indigo-900/10 border-indigo-100/80 dark:border-indigo-500/20 hover:bg-indigo-50/80 dark:hover:bg-indigo-900/20' : 'bg-amber-50/40 dark:bg-amber-900/10 border-amber-100/80 dark:border-amber-500/20 hover:bg-amber-50/80 dark:hover:bg-amber-900/20';
                                                glowColor = isSafe ? 'bg-indigo-200/50 dark:bg-indigo-500/10' : 'bg-amber-200/50 dark:bg-amber-500/10';
                                                dayLabelColor = 'text-slate-500/70 dark:text-slate-400';
                                                dateLabelColor = 'text-slate-500/90 dark:text-slate-400';
                                                editBtnColor = 'hover:bg-white/80 dark:hover:bg-slate-700 text-slate-400 hover:text-indigo-500';
                                                deleteBtnColor = 'hover:bg-white/80 dark:hover:bg-slate-700 text-slate-400 hover:text-rose-500';
                                                thresholdCardBg = 'bg-white/40 dark:bg-slate-900/30 border border-slate-100/50 dark:border-white/5';
                                                thresholdLabelColor = 'text-slate-400 dark:text-slate-500';
                                                thresholdValueColor = 'text-slate-700 dark:text-slate-300';
                                                userCardStyle = isSafe ? 'bg-white/80 dark:bg-slate-800/80 border-indigo-100/50 dark:border-indigo-500/20' : 'bg-white/80 dark:bg-slate-800/80 border-amber-100/50 dark:border-amber-500/20';
                                                userLabelColor = isSafe ? 'text-indigo-600 dark:text-indigo-400' : 'text-amber-600 dark:text-amber-400';
                                                userValueColor = isSafe ? 'text-indigo-800 dark:text-indigo-100' : 'text-amber-800 dark:text-amber-100';
                                                percentColor = isSafe ? 'text-indigo-600/80 dark:text-indigo-400/80' : 'text-amber-600/80 dark:text-amber-400/80';
                                                dotStyle = `border-[3px] ${isSafe ? 'border-indigo-500' : 'border-amber-500'}`;
                                            }

                                            return (
                                                <div key={item.id} className={`group/item relative p-1.5 border rounded-xl transition-all duration-300 shadow-sm hover:shadow dark:shadow-none backdrop-blur-sm overflow-hidden ${cardBaseStyle}`}>
                                                    <div className={`absolute -top-6 -right-6 w-20 h-20 rounded-full blur-2xl opacity-30 transition-opacity group-hover/item:opacity-50 pointer-events-none ${glowColor}`}></div>
                                                    <div className="flex justify-between items-center mb-1 px-1 relative z-10">
                                                        <div className="flex items-center gap-2">
                                                            {isLatest ? (<div className="w-1.5 h-1.5 rounded-sm rotate-45 bg-[#F0B90B] shadow-[0_0_5px_rgba(240,185,11,0.8)]"></div>) : (<div className={`w-1.5 h-1.5 rounded-full ${item.source === 'ai' ? 'bg-cyan-400 shadow-[0_0_5px_rgba(34,211,238,0.8)]' : 'bg-purple-400 shadow-[0_0_5px_rgba(192,132,252,0.8)]'}`} />)}
                                                            <span className={`text-[10px] font-bold uppercase tracking-widest ${dayLabelColor}`}>{item.displayDay} {isLatest && <span className="ml-1 text-[8px] px-1 py-0.5 rounded bg-[#F0B90B] text-black font-extrabold leading-none">END</span>}</span>
                                                            <div className={`h-3 w-[1px] mx-0.5 ${isLatest ? 'bg-[#474D57]' : 'bg-slate-300/50 dark:bg-slate-700'}`}></div>
                                                            <span className={`text-[10px] font-mono font-bold ${dateLabelColor}`}>{new Date(item.timestamp).toLocaleDateString(undefined, {month:'numeric', day:'numeric'})}</span>
                                                        </div>
                                                        <div className="flex items-center gap-1">
                                                            <button onClick={(e) => { e.stopPropagation(); handleEditItem(item); }} className={`p-1 rounded-lg transition-colors ${editBtnColor}`} title={t.edit}><Icon name="edit-2" size={12} /></button>
                                                            <button onClick={(e) => { e.stopPropagation(); const newData = dataList.filter(d => d.id !== item.id); persistData(newData); }} className={`p-1 rounded-lg transition-colors ${deleteBtnColor}`} title={t.delete}><Icon name="x" size={12} /></button>
                                                        </div>
                                                    </div>
                                                    <div className="grid grid-cols-2 gap-1.5 relative z-10">
                                                        <div className={`flex flex-col justify-center p-1.5 rounded-lg ${thresholdCardBg}`}>
                                                            <span className={`text-[10px] font-extrabold uppercase flex items-center gap-1.5 mb-0.5 ${thresholdLabelColor}`}><Icon name="crosshair" size={10} /> {isLatest ? t.legendTotalVolume : t.legendThreshold}</span>
                                                            <span className={`text-base font-rounded font-bold leading-none tracking-tight ${thresholdValueColor}`}>${item.volume.toLocaleString()}</span>
                                                        </div>
                                                        <div className={`flex flex-col justify-center p-1.5 rounded-lg ${userCardStyle}`}>
                                                            <span className={`text-[10px] font-extrabold uppercase flex items-center gap-1.5 mb-0.5 ${userLabelColor}`}><Icon name="user" size={10} /> {t.legendUser}</span>
                                                            <div className="flex items-end justify-between gap-1 w-full relative z-10">
                                                                <span className={`text-base font-rounded font-bold leading-none tracking-tight ${userValueColor}`}>${item.userVolume.toLocaleString()}</span>
                                                                <span className={`text-[10px] font-rounded font-extrabold leading-none ${percentColor}`}>{gapPercent > 0 ? '+' : ''}{gapPercent.toFixed(1)}%</span>
                                                            </div>
                                                            {isLatest ? (<div className={`absolute top-1.5 right-1.5 w-1.5 h-1.5 rounded-full ${dotStyle}`}></div>) : (<div className={`absolute -right-2 -bottom-2 w-8 h-8 rounded-full border-[3px] opacity-10 pointer-events-none ${isSafe ? 'border-indigo-500' : 'border-amber-500'}`}></div>)}
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                            
                            {/* Right Column (Chart) */}
                            <div className="lg:col-span-2 flex flex-col h-full">
                                <div className="relative overflow-hidden bg-white dark:bg-slate-900/60 backdrop-blur-md rounded-3xl border border-indigo-200 dark:border-indigo-500/30 shadow-sm hover:shadow-xl dark:shadow-lg dark:hover:shadow-indigo-900/30 transition-all duration-300 flex flex-col h-full">
                                     <div className="absolute inset-0 bg-gradient-to-br from-indigo-100/30 dark:from-indigo-900/10 to-transparent opacity-50 pointer-events-none"></div>
                                    <div className="relative z-10 px-5 py-3 border-b border-indigo-100 dark:border-indigo-500/20 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 bg-white/50 dark:bg-slate-900/40">
                                        <div className="flex items-center gap-3">
                                            <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 to-violet-600 flex items-center justify-center text-white shadow-lg shadow-indigo-500/30"><Icon name="radar" size={20} /></div>
                                            <div>
                                                <h2 className="text-lg font-black text-slate-800 dark:text-white tracking-tight flex items-center gap-2">{t.marketIntelTitle}</h2>
                                                <div className="text-xs font-medium text-slate-500 dark:text-slate-400">{t.growthCurve} & {t.analysis}</div>
                                            </div>
                                        </div>
                                        <div className="flex gap-2 w-full sm:w-auto">
                                            <div className="bg-slate-100 dark:bg-slate-800 p-1 rounded-xl flex border border-slate-200 dark:border-slate-700 shrink-0">
                                                <button onClick={() => setChartViewMode('curve')} className={`p-2 rounded-lg transition-all ${chartViewMode === 'curve' ? 'bg-white dark:bg-slate-600 shadow-sm text-indigo-500' : 'text-slate-400 hover:text-slate-600 dark:hover:text-slate-300'}`} title="Curve View"><Icon name="waves" size={18} /></button>
                                                <button onClick={() => setChartViewMode('pixel')} className={`p-2 rounded-lg transition-all ${chartViewMode === 'pixel' ? 'bg-white dark:bg-slate-600 shadow-sm text-indigo-500' : 'text-slate-400 hover:text-slate-600 dark:hover:text-slate-300'}`} title="Pixel Analysis View"><Icon name="bar-chart-2" size={18} /></button>
                                            </div>
                                            <button onClick={generateAIStrategy} disabled={isGeneratingStrategy} className="flex-1 sm:flex-none px-4 py-2 bg-gradient-to-r from-indigo-600 to-violet-600 text-white rounded-xl text-xs font-bold flex items-center justify-center gap-2 hover:shadow-lg dark:hover:shadow-[0_0_20px_-5px_rgba(99,102,241,0.6)] border border-white/10 transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap"><Icon name={isGeneratingStrategy ? "loader-2" : "sparkles"} className={isGeneratingStrategy ? "animate-spin" : ""} size={16} />{isGeneratingStrategy ? t.aiAnalyzing : t.aiAnalysis}</button>
                                        </div>
                                    </div>

                                    <div className="relative z-10 flex-1 flex flex-col p-4 overflow-hidden">
                                        {aiStrategy && (
                                            <div className="mb-4 animate-in slide-in-from-top-4 fade-in duration-500">
                                                <div className={`relative overflow-hidden rounded-2xl border transition-all duration-300 ${isAICollapsed ? 'bg-slate-50 dark:bg-slate-800/50 border-slate-200 dark:border-slate-700 hover:border-indigo-300 dark:hover:border-indigo-500/50' : 'bg-gradient-to-br from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 border-indigo-200 dark:border-indigo-500/30 shadow-lg'}`}>
                                                    <div className="p-4 flex items-center justify-between cursor-pointer group select-none" onClick={() => setIsAICollapsed(!isAICollapsed)}>
                                                        <div className="flex items-center gap-3">
                                                            <div className={`w-8 h-8 rounded-lg flex items-center justify-center transition-colors ${isAICollapsed ? 'bg-slate-200 dark:bg-slate-700 text-slate-500' : 'bg-indigo-100 dark:bg-indigo-500/20 text-indigo-600 dark:text-indigo-400'}`}><Icon name="brain-circuit" size={18} /></div>
                                                            <div className="flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-3">
                                                                <span className="font-bold text-slate-700 dark:text-slate-200 text-sm">{t.geminiInsight}</span>
                                                                <div className="flex gap-2">
                                                                    <span className="px-2 py-0.5 bg-white/50 dark:bg-black/20 rounded text-[10px] font-bold text-slate-500 dark:text-slate-400 border border-slate-200 dark:border-slate-700/50">{aiStrategy.marketPhase}</span>
                                                                    <span className={`px-2 py-0.5 rounded text-[10px] font-bold flex items-center gap-1 border ${aiStrategy.riskLevel.includes('High') || aiStrategy.riskLevel.includes('高') ? 'bg-rose-100/50 dark:bg-rose-500/20 text-rose-600 dark:text-rose-400 border-rose-200 dark:border-rose-500/30' : 'bg-emerald-100/50 dark:bg-emerald-500/20 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-500/30'}`}>{aiStrategy.riskLevel}</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div className="flex items-center gap-2"><span className="text-[10px] font-bold text-slate-400 uppercase tracking-wider hidden sm:block">{isAICollapsed ? 'Expand Report' : 'Minimize'}</span><Icon name={isAICollapsed ? "chevron-down" : "chevron-up"} size={16} className="text-slate-400 group-hover:text-indigo-500 transition-colors" /></div>
                                                    </div>
                                                    {!isAICollapsed && (
                                                        <div className="px-4 pb-4 sm:px-6 sm:pb-6 pt-0 animate-in slide-in-from-top-2 fade-in">
                                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 pt-4 border-t border-indigo-100/50 dark:border-white/5">
                                                                <div className="space-y-3">
                                                                    <p className="text-sm text-slate-600 dark:text-slate-300 leading-relaxed font-medium">{aiStrategy.analysis || aiStrategy.strategy}</p>
                                                                    {aiStrategy.psychologicalTip && (<div className="flex items-start gap-2.5 p-2.5 rounded-lg bg-orange-50/50 dark:bg-orange-500/5 border border-orange-100 dark:border-orange-500/10"><Icon name="coffee" size={14} className="text-orange-400 mt-0.5 shrink-0" /><p className="text-xs font-bold text-orange-700 dark:text-orange-300 italic">"{aiStrategy.psychologicalTip}"</p></div>)}
                                                                </div>
                                                                <div>
                                                                    <ul className="space-y-2 mb-3">
                                                                        {aiStrategy.actionableAdvice && Array.isArray(aiStrategy.actionableAdvice) ? aiStrategy.actionableAdvice.map((advice, idx) => (<li key={idx} className="flex gap-2 items-start text-sm text-slate-700 dark:text-slate-200"><div className="mt-1 w-4 h-4 rounded-full bg-indigo-100 dark:bg-indigo-500/20 flex items-center justify-center text-indigo-600 dark:text-indigo-400 text-[10px] font-bold shrink-0">{idx + 1}</div><span className="leading-snug">{advice}</span></li>)) : null}
                                                                    </ul>
                                                                    <div className="flex justify-end"><button className="text-[10px] font-bold text-indigo-500 hover:text-indigo-600 dark:text-indigo-400 dark:hover:text-indigo-300 flex items-center gap-1 transition-colors" onClick={(e) => { e.stopPropagation(); copyText(`[AlphaDash AI Report]\nPhase: ${aiStrategy.marketPhase}\nRisk: ${aiStrategy.riskLevel}\n\n${aiStrategy.analysis}\n\nAdvice:\n${aiStrategy.actionableAdvice?.map((a,i)=>`${i+1}. ${a}`).join('\n')}`); }}><Icon name="copy" size={12} /> COPY</button></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        )}

                                        <div className="flex-1 w-full min-h-[300px] md:min-h-[420px] relative">
                                            {chartViewMode === 'curve' ? (
                                                <ResponsiveContainer width="100%" height="100%">
                                                    <AreaChart data={chartData} margin={{ top: 10, right: 10, left: -20, bottom: 0 }}>
                                                        <defs>
                                                            <linearGradient id="colorVol" x1="0" y1="0" x2="0" y2="1"><stop offset="5%" stopColor="#6366f1" stopOpacity={0.4}/><stop offset="95%" stopColor="#6366f1" stopOpacity={0}/></linearGradient>
                                                            <linearGradient id="colorUser" x1="0" y1="0" x2="0" y2="1"><stop offset="5%" stopColor="#10b981" stopOpacity={0.4}/><stop offset="95%" stopColor="#10b981" stopOpacity={0}/></linearGradient>
                                                            <filter id="glow" x="-50%" y="-50%" width="200%" height="200%"><feGaussianBlur stdDeviation="2.5" result="coloredBlur" /><feMerge><feMergeNode in="coloredBlur" /><feMergeNode in="SourceGraphic" /></feMerge></filter>
                                                        </defs>
                                                        <CartesianGrid strokeDasharray="3 3" vertical={false} stroke={theme === 'dark' ? "#1e293b" : "#e2e8f0"} opacity={0.5} />
                                                        <XAxis dataKey="displayDay" axisLine={false} tickLine={false} tick={{fontSize:10, fill: theme === 'dark' ? '#64748b' : '#94a3b8', fontWeight:700}} dy={10} />
                                                        <YAxis axisLine={false} tickLine={false} tick={{fontSize:10, fill: theme === 'dark' ? '#64748b' : '#94a3b8', fontWeight:700}} tickFormatter={v => `${(v/1000).toFixed(0)}k`} />
                                                        <Tooltip content={<CustomTooltip t={t} />} cursor={{stroke: '#a5b4fc', strokeWidth: 1, strokeDasharray: '5 5', strokeOpacity: 0.5}} />
                                                        <Area type="monotone" dataKey="volume" stroke="#6366f1" strokeWidth={3} fill="url(#colorVol)" animationDuration={1500} style={{ filter: 'url(#glow)' }} activeDot={(props) => (<svg><circle cx={props.cx} cy={props.cy} r={8} fill="#6366f1" opacity="0.3" className="animate-ping" /><circle cx={props.cx} cy={props.cy} r={4} fill="#fff" stroke="#6366f1" strokeWidth={2} /></svg>)} />
                                                        <Area type="monotone" dataKey="userVolume" stroke="#10b981" strokeWidth={3} fill="url(#colorUser)" strokeDasharray="4 4" animationDuration={1500} style={{ filter: 'url(#glow)' }} activeDot={(props) => (<svg><circle cx={props.cx} cy={props.cy} r={8} fill="#10b981" opacity="0.3" className="animate-ping" /><circle cx={props.cx} cy={props.cy} r={4} fill="#fff" stroke="#10b981" strokeWidth={2} /></svg>)} />
                                                    </AreaChart>
                                                </ResponsiveContainer>
                                            ) : (
                                                <PixelChart data={chartData} t={t} />
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Footer Info Cards */}
                    <div className="max-w-6xl mx-auto w-full mt-8 mb-4">
                        <div className="grid grid-cols-2 sm:flex sm:flex-row justify-center items-center gap-3">
                            <div className="flex items-center justify-center gap-2 h-10 px-4 md:px-6 bg-white dark:bg-slate-800/50 rounded-xl border border-slate-200 dark:border-slate-700/50 backdrop-blur-md shadow-sm hover:bg-slate-50 dark:hover:bg-slate-700/80 transition-all cursor-default group">
                                <span className="relative flex h-2 w-2"><span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span><span className="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span></span>
                                <span className="text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider group-hover:text-emerald-500 transition-colors">{t.visitorCount}</span>
                                <span className="text-xs font-rounded font-bold text-slate-700 dark:text-slate-200 tabular-nums">{visitorCount.toLocaleString()}</span>
                            </div>
                            <div className="w-[1px] h-6 bg-slate-200 dark:bg-slate-700 hidden sm:block"></div>
                            <div className="flex items-center justify-center gap-2 h-10 px-4 md:px-6 bg-white dark:bg-slate-800/50 rounded-xl border border-slate-200 dark:border-slate-700/50 backdrop-blur-md shadow-sm hover:bg-slate-50 dark:hover:bg-slate-700/80 transition-all cursor-default group">
                                <Icon name="tag" size={16} className="text-slate-500 dark:text-slate-400 group-hover:text-emerald-400 transition-colors" />
                                <span className="text-xs font-bold text-slate-500 dark:text-slate-400 group-hover:text-slate-700 dark:group-hover:text-slate-200 transition-colors">v10.6</span>
                            </div>
                            <div className="w-[1px] h-6 bg-slate-200 dark:bg-slate-700 hidden sm:block"></div>
                            <a href="https://x.com/" target="_blank" rel="noopener noreferrer" className="flex items-center justify-center gap-2 h-10 px-4 md:px-6 bg-white dark:bg-slate-800/50 rounded-xl border border-slate-200 dark:border-slate-700/50 backdrop-blur-md shadow-sm hover:bg-slate-50 dark:hover:bg-slate-700/80 transition-all active:scale-95 group"><Icon name="twitter" size={16} className="text-slate-500 dark:text-slate-400 group-hover:text-blue-400 transition-colors" /><span className="text-xs font-bold text-slate-500 dark:text-slate-400 group-hover:text-slate-700 dark:group-hover:text-slate-200 transition-colors">{t.followX}</span></a>
                            <div className="w-[1px] h-6 bg-slate-200 dark:bg-slate-700 hidden sm:block"></div>
                            <button onClick={() => setShowAboutModal(true)} className="flex items-center justify-center gap-2 h-10 px-4 md:px-6 bg-white dark:bg-slate-800/50 rounded-xl border border-slate-200 dark:border-slate-700/50 backdrop-blur-md shadow-sm hover:bg-slate-50 dark:hover:bg-slate-700/80 transition-all active:scale-95 group"><Icon name="info" size={16} className="text-slate-500 dark:text-slate-400 group-hover:text-indigo-400 transition-colors" /><span className="text-xs font-bold text-slate-500 dark:text-slate-400 group-hover:text-slate-700 dark:group-hover:text-slate-200 transition-colors">{t.about}</span></button>
                            <div className="w-[1px] h-6 bg-slate-200 dark:bg-slate-700 hidden sm:block"></div>
                            <button onClick={() => setShowDonationModal(true)} className="flex items-center justify-center gap-2 h-10 px-4 md:px-6 bg-white dark:bg-slate-800/50 rounded-xl border border-slate-200 dark:border-slate-700/50 backdrop-blur-md shadow-sm hover:bg-slate-50 dark:hover:bg-slate-700/80 transition-all active:scale-95 group"><Icon name="heart" size={16} className="text-slate-500 dark:text-slate-400 group-hover:text-rose-400 transition-colors" /><span className="text-xs font-bold text-slate-500 dark:text-slate-400 group-hover:text-slate-700 dark:group-hover:text-slate-200 transition-colors">{t.donation}</span></button>
                        </div>
                    </div>

                    {/* --- Modals --- */}
                    
                    <Modal isOpen={showCompModal} onClose={() => setShowCompModal(false)} title={t.switchCompetition} maxWidth="max-w-sm">
                         <div className="space-y-2">
                             {competitions.map(comp => (
                                 <div key={comp.id} onClick={() => { setCurrentComp(comp); setShowCompModal(false); }} className={`p-3 rounded-xl border transition-all cursor-pointer flex items-center justify-between group ${currentComp.id === comp.id ? 'bg-indigo-50 border-indigo-500 dark:bg-indigo-500/20 dark:border-indigo-400 shadow-md' : 'bg-white dark:bg-slate-800/50 border-slate-200 dark:border-slate-700 hover:border-indigo-300 dark:hover:border-slate-600'}`}>
                                     <div className="flex items-center gap-3">
                                         <div className={`w-9 h-9 rounded-full flex items-center justify-center text-white font-bold shadow-md bg-gradient-to-br ${comp.gradient}`}><Icon name={comp.icon} size={16} /></div>
                                         <div><div className="font-bold text-sm text-slate-900 dark:text-white">{comp.name}</div><div className="text-[10px] text-slate-500 dark:text-slate-400 font-mono">{comp.symbol}</div></div>
                                     </div>
                                     <div className="flex gap-2">
                                         <button onClick={(e) => { e.stopPropagation(); openManageModal(comp); }} className="p-1.5 text-slate-400 hover:text-indigo-500 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors"><Icon name="edit-2" size={14} /></button>
                                         <button onClick={(e) => handleDeleteRequest(comp.id, e)} className="p-1.5 text-slate-400 hover:text-rose-500 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors"><Icon name="trash-2" size={14} /></button>
                                     </div>
                                 </div>
                             ))}
                             <button onClick={() => { setShowCompModal(false); openManageModal(); }} className="w-full p-3 rounded-xl border border-dashed border-slate-300 dark:border-slate-600 text-slate-500 dark:text-slate-400 hover:border-indigo-400 hover:text-indigo-500 hover:bg-indigo-50 dark:hover:bg-indigo-500/10 transition-all font-bold text-sm flex items-center justify-center gap-2"><Icon name="plus" size={16} /> {t.addCompetition}</button>
                             <div className="flex gap-2 pt-3 mt-1 border-t border-slate-100 dark:border-slate-800">
                                <button onClick={handleExportData} className="flex-1 px-3 py-2.5 rounded-xl bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 text-xs font-bold hover:bg-slate-100 dark:hover:bg-slate-700 hover:border-slate-300 transition-all flex items-center justify-center gap-2 group"><Icon name="download" size={14} className="text-slate-400 group-hover:text-indigo-500 transition-colors"/> {t.exportData}</button>
                                <label className="flex-1 px-3 py-2.5 rounded-xl bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 text-xs font-bold hover:bg-slate-100 dark:hover:bg-slate-700 hover:border-slate-300 transition-all flex items-center justify-center gap-2 cursor-pointer group"><Icon name="upload" size={14} className="text-slate-400 group-hover:text-indigo-500 transition-colors"/> {t.importData}<input type="file" onChange={handleImportData} className="hidden" accept=".json" /></label>
                             </div>
                         </div>
                    </Modal>

                    <Modal isOpen={showManualModal} onClose={() => setShowManualModal(false)} title={editingItem ? t.edit : t.manualModalTitle} maxWidth="max-w-xl">
                        <div className="space-y-4">
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1">{t.dateLabel}</label>
                                    <div className="relative">
                                        <div className="absolute left-4 top-1/2 -translate-y-1/2 text-indigo-500 dark:text-indigo-400 pointer-events-none"><Icon name="calendar" size={18} /></div>
                                        <input type="date" value={manualDate} onChange={e => setManualDate(e.target.value)} className="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-xl pl-11 pr-4 py-3 text-slate-900 dark:text-white font-rounded font-bold text-base focus:ring-2 focus:ring-indigo-500 outline-none transition-all hover:bg-slate-200 dark:hover:bg-slate-700/50" style={{colorScheme: theme === 'dark' ? 'dark' : 'light'}} />
                                    </div>
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1">{t.costLabel}</label>
                                    <div className="relative"><span className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold text-base">$</span><input type="number" value={manualCost} onChange={e => setManualCost(e.target.value)} placeholder="0.00" className="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-xl pl-8 pr-4 py-3 text-slate-900 dark:text-white font-rounded font-bold text-base focus:ring-2 focus:ring-rose-500 outline-none hover:bg-slate-200 dark:hover:bg-slate-700/50 transition-all" /></div>
                                </div>
                            </div>
                            
                            {showPeriodInputs ? (
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 pt-2 border-t border-slate-100 dark:border-slate-800 relative">
                                    {dataList.length > 0 && (<button onClick={() => setShowPeriodInputs(false)} className="absolute top-2 right-0 text-[10px] text-indigo-500 hover:text-indigo-600 font-bold bg-indigo-50 dark:bg-indigo-500/10 px-2 py-0.5 rounded transition-colors">{t.cancel}</button>)}
                                    <div>
                                        <label className="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1">{t.startLabel}</label>
                                        <div className="flex gap-2">
                                            <div className="relative w-[60%]"><input type="date" value={manualStartDate} onChange={e => setManualStartDate(e.target.value)} className="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-xl px-3 py-3 text-base font-rounded font-bold outline-none focus:ring-2 focus:ring-indigo-500 transition-all" style={{colorScheme: theme === 'dark' ? 'dark' : 'light'}} /></div>
                                            <div className="flex items-center justify-center w-[40%] bg-slate-100 dark:bg-slate-800 rounded-xl px-3"><select value={manualStartHour} onChange={e => setManualStartHour(e.target.value)} className="bg-transparent border-none text-base font-rounded font-bold py-3 outline-none cursor-pointer text-center flex-1 appearance-none hover:text-indigo-500 transition-colors">{hours.map(h => <option key={h} value={h}>{h}</option>)}</select><span className="text-slate-400 font-bold text-base px-1 shrink-0">:</span><select value={manualStartMinute} onChange={e => setManualStartMinute(e.target.value)} className="bg-transparent border-none text-base font-rounded font-bold py-3 outline-none cursor-pointer text-center flex-1 appearance-none hover:text-indigo-500 transition-colors">{minutes.map(m => <option key={m} value={m}>{m}</option>)}</select></div>
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1">{t.endLabel}</label>
                                        <div className="flex gap-2">
                                            <div className="relative w-[60%]"><input type="date" value={manualEndDate} onChange={e => setManualEndDate(e.target.value)} className="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-xl px-3 py-3 text-base font-rounded font-bold outline-none focus:ring-2 focus:ring-indigo-500 transition-all" style={{colorScheme: theme === 'dark' ? 'dark' : 'light'}} /></div>
                                            <div className="flex items-center justify-center w-[40%] bg-slate-100 dark:bg-slate-800 rounded-xl px-3"><select value={manualEndHour} onChange={e => setManualEndHour(e.target.value)} className="bg-transparent border-none text-base font-rounded font-bold py-3 outline-none cursor-pointer text-center flex-1 appearance-none hover:text-indigo-500 transition-colors">{hours.map(h => <option key={h} value={h}>{h}</option>)}</select><span className="text-slate-400 font-bold text-base px-1 shrink-0">:</span><select value={manualEndMinute} onChange={e => setManualEndMinute(e.target.value)} className="bg-transparent border-none text-base font-rounded font-bold py-3 outline-none cursor-pointer text-center flex-1 appearance-none hover:text-indigo-500 transition-colors">{minutes.map(m => <option key={m} value={m}>{m}</option>)}</select></div>
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                <div className="pt-2 border-t border-slate-100 dark:border-slate-800 flex justify-between items-center group">
                                    <div><div className="text-[10px] text-slate-400 font-bold uppercase tracking-wider">{t.periodLabel}</div><div className="text-xs font-mono font-bold text-slate-700 dark:text-slate-300 mt-0.5">{formatTimeDisplay(currentComp.startDate)} - {formatTimeDisplay(currentComp.endDate)}</div></div>
                                    <button onClick={() => setShowPeriodInputs(true)} className="p-2 rounded-lg bg-slate-50 hover:bg-slate-100 dark:bg-slate-800 dark:hover:bg-slate-700 text-slate-400 hover:text-indigo-500 transition-colors" title={t.edit}><Icon name="edit-2" size={14} /></button>
                                </div>
                            )}
                            
                            <div><label className="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1">{t.volumeLabel}</label><div className="relative"><span className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold text-base">$</span><input type="number" value={manualVolume} onChange={e => setManualVolume(e.target.value)} placeholder="0.00" className="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-xl pl-8 pr-4 py-3 text-slate-900 dark:text-white font-rounded font-bold text-base focus:ring-2 focus:ring-indigo-500 outline-none" /></div></div>
                            <div><label className="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1">{t.userVolumeLabel}</label><div className="relative"><span className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold text-base">$</span><input type="number" value={manualUserVolume} onChange={e => setManualUserVolume(e.target.value)} placeholder="0.00" className="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-xl pl-8 pr-4 py-3 text-slate-900 dark:text-white font-rounded font-bold text-base focus:ring-2 focus:ring-emerald-500 outline-none" /></div></div>

                            <div className="grid grid-cols-2 gap-4">
                                <div><label className="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1">{t.rewardLabel}</label><input type="number" value={manualReward} onChange={e => setManualReward(e.target.value)} placeholder="0" className="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white font-rounded font-bold text-base focus:ring-2 focus:ring-amber-500 outline-none" /></div>
                                <div><label className="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1">{t.eligibilityLabel}</label><input type="number" value={manualEligibility} onChange={e => setManualEligibility(e.target.value)} placeholder="0" className="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white font-rounded font-bold text-base focus:ring-2 focus:ring-blue-500 outline-none" /></div>
                            </div>
                            <button onClick={handleManualSubmit} className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-indigo-500/30 active:scale-[0.98] transition-all">{t.confirmButton}</button>
                        </div>
                    </Modal>

                    <Modal isOpen={showSettingsModal} onClose={() => setShowSettingsModal(false)} title={t.settings}>
                        <div className="space-y-6">
                            <div className="text-center space-y-2">
                                <div className="w-12 h-12 mx-auto bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-indigo-500/30"><Icon name="key" size={24} /></div>
                                <div><h3 className="text-sm font-bold text-slate-800 dark:text-white">{t.apiKeyLabel}</h3><p className="text-xs text-slate-500 dark:text-slate-400 max-w-[90%] mx-auto leading-relaxed mt-1">{t.apiKeyHint}</p></div>
                            </div>
                            <div className="space-y-3">
                                {[0, 1, 2].map((idx) => {
                                    const isActive = tempKeys[idx] && tempKeys[idx].length > 10;
                                    return (
                                        <div key={idx} className={`relative group transition-all duration-300 ${idx === 0 ? 'scale-100' : 'scale-[0.98] opacity-90 hover:opacity-100 hover:scale-100'}`}>
                                            <div className={`absolute -top-2 left-3 px-2 py-0.5 rounded text-[9px] font-bold uppercase tracking-wider z-10 border transition-colors ${idx === 0 ? 'bg-indigo-500 text-white border-indigo-600 shadow-sm' : 'bg-slate-200 dark:bg-slate-700 text-slate-500 dark:text-slate-400 border-slate-300 dark:border-slate-600'}`}>{idx === 0 ? t.key1Label : (idx === 1 ? t.key2Label : t.key3Label)}</div>
                                            <div className={`relative flex items-center bg-slate-50 dark:bg-slate-800/50 border-2 rounded-xl transition-all overflow-hidden ${isActive ? 'border-emerald-500/30 dark:border-emerald-500/30 bg-emerald-50/10' : 'border-slate-200 dark:border-slate-700/50 focus-within:border-indigo-500/50 dark:focus-within:border-indigo-500/50'}`}>
                                                <div className={`pl-3 pr-2 py-3 flex items-center justify-center border-r border-slate-200/50 dark:border-slate-700/50 ${isActive ? 'text-emerald-500' : 'text-slate-400'}`}><Icon name={idx === 0 ? "key" : "shield"} size={18} /></div>
                                                <input type="password" value={tempKeys[idx]} onChange={e => { const newKeys = [...tempKeys]; newKeys[idx] = e.target.value; setTempKeys(newKeys); }} placeholder={t.apiKeyPlaceholder} className="w-full bg-transparent border-none px-3 py-3 text-slate-900 dark:text-white font-rounded font-bold text-sm focus:ring-0 outline-none placeholder:text-slate-400/50" />
                                                <div className="pr-3">{isActive ? (<Icon name="check-circle" size={18} className="text-emerald-500" />) : (<div className="w-2 h-2 rounded-full bg-slate-300 dark:bg-slate-700" />)}</div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                            <div className="flex gap-3 pt-2 border-t border-slate-100 dark:border-slate-800/50 mt-2">
                                <button onClick={clearKey} className="flex-1 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 font-bold py-3.5 rounded-xl transition-all text-sm flex items-center justify-center gap-2 group"><Icon name="trash-2" size={16} className="group-hover:text-rose-500 transition-colors" />{t.clearKey}</button>
                                <button onClick={confirmSaveKey} className="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-indigo-500/20 active:scale-[0.98] transition-all text-sm flex items-center justify-center gap-2"><Icon name="save" size={16} />{t.saveKey}</button>
                            </div>
                        </div>
                    </Modal>

                    <Modal isOpen={showAboutModal} onClose={() => setShowAboutModal(false)} title={t.aboutTitle}>
                        <div className="space-y-4">
                            <div className="w-16 h-16 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white shadow-xl mx-auto mb-2"><Icon name="activity" size={32} /></div>
                            <p className="text-sm text-slate-600 dark:text-slate-300 leading-relaxed text-center">{t.aboutDesc}</p>
                            <div className="flex justify-center gap-4 pt-4 border-t border-slate-100 dark:border-slate-800">
                                <a href="https://x.com/" target="_blank" rel="noopener noreferrer" className="flex items-center gap-2 text-slate-500 hover:text-blue-500 transition-colors"><Icon name="twitter" size={18} /><span className="text-xs font-bold">Twitter</span></a>
                                <a href="#" className="flex items-center gap-2 text-slate-500 hover:text-indigo-500 transition-colors"><Icon name="github" size={18} /><span className="text-xs font-bold">Github</span></a>
                            </div>
                            <div className="text-center text-[10px] text-slate-400 pt-2 font-mono">AlphaDash v10.6 • Local-First Architecture</div>
                        </div>
                    </Modal>

                    <Modal isOpen={showDonationModal} onClose={() => setShowDonationModal(false)} title={t.donationTitle}>
                        <div className="space-y-4">
                            <p className="text-sm text-slate-600 dark:text-slate-300 text-center mb-4">{t.donationDesc}</p>
                            <div className="flex bg-slate-100 dark:bg-slate-800 p-1 rounded-xl mb-4">
                                {Object.keys(donationAddresses).map(chain => (
                                    <button key={chain} onClick={() => setDonateTab(chain)} className={`flex-1 py-2 rounded-lg text-xs font-bold uppercase transition-all ${donateTab === chain ? 'bg-white dark:bg-slate-700 text-indigo-600 dark:text-indigo-400 shadow-sm' : 'text-slate-500 hover:text-slate-700 dark:hover:text-slate-300'}`}>{chain.toUpperCase()}</button>
                                ))}
                            </div>
                            <div className="relative group">
                                <div className="p-4 bg-slate-100 dark:bg-slate-800 rounded-xl break-all text-xs font-mono text-center text-slate-600 dark:text-slate-300 border border-slate-200 dark:border-slate-700">
                                    {currentAddress}
                                </div>
                                <button onClick={() => copyText(currentAddress)} className="absolute inset-0 w-full h-full bg-indigo-600/90 text-white font-bold opacity-0 group-hover:opacity-100 transition-opacity rounded-xl flex items-center justify-center gap-2 backdrop-blur-sm"><Icon name="copy" size={16} /> {t.copy}</button>
                            </div>
                            <div className="flex justify-center">
                                <img src={`https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${currentAddress}&color=4f46e5&bgcolor=${theme === 'dark' ? '0f172a' : 'ffffff'}`} alt="QR Code" className="w-32 h-32 rounded-xl p-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 shadow-sm" />
                            </div>
                        </div>
                    </Modal>

                    <Modal isOpen={showDeleteModal} onClose={() => setShowDeleteModal(false)} title={t.deleteConfirmTitle}>
                        <div className="space-y-4 text-center">
                            <div className="w-16 h-16 rounded-full bg-rose-100 dark:bg-rose-900/20 text-rose-500 flex items-center justify-center mx-auto mb-2"><Icon name="alert-triangle" size={32} /></div>
                            <p className="text-sm text-slate-600 dark:text-slate-300">{t.deleteConfirmDesc}</p>
                            <div className="flex gap-3 pt-2">
                                <button onClick={() => setShowDeleteModal(false)} className="flex-1 bg-slate-100 hover:bg-slate-200 dark:bg-slate-800 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 font-bold py-3 rounded-xl transition-all text-xs">{t.cancel}</button>
                                <button onClick={confirmDeleteCompetition} className="flex-1 bg-rose-500 hover:bg-rose-600 text-white font-bold py-3 rounded-xl shadow-lg shadow-rose-500/30 active:scale-[0.98] transition-all text-xs">{t.confirmDelete}</button>
                            </div>
                        </div>
                    </Modal>

                    <Modal isOpen={showManageModal} onClose={() => setShowManageModal(false)} title={editingComp ? t.editCompetition : t.addCompetition} maxWidth="max-w-2xl">
                        <div className="space-y-4">
                            <div className="grid grid-cols-2 gap-4">
                                <div><label className="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1">{t.compName}</label><input type="text" value={compForm.name} onChange={e => setCompForm({...compForm, name: e.target.value})} className="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white font-bold text-base focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="e.g. Midnight" /></div>
                                <div><label className="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1">{t.compSymbol}</label><input type="text" value={compForm.symbol} onChange={e => setCompForm({...compForm, symbol: e.target.value})} className="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white font-bold text-base focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="e.g. NIGHT" /></div>
                            </div>
                            
                            <div><label className="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1">{t.compCgId}</label><input type="text" value={compForm.coingeckoId} onChange={e => setCompForm({...compForm, coingeckoId: e.target.value})} className="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white font-bold text-base focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="e.g. midnight-3" /></div>
                            
                            <div className="grid grid-cols-2 gap-4">
                                <div><label className="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1">{t.rewardLabel}</label><input type="number" value={compForm.reward} onChange={e => setCompForm({...compForm, reward: e.target.value})} className="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white font-bold text-base focus:ring-2 focus:ring-amber-500 outline-none" placeholder="0" /></div>
                                <div><label className="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1">{t.eligibilityLabel}</label><input type="number" value={compForm.eligibility} onChange={e => setCompForm({...compForm, eligibility: e.target.value})} className="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white font-bold text-base focus:ring-2 focus:ring-blue-500 outline-none" placeholder="0" /></div>
                            </div>

                            <div>
                                <label className="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-2">{t.compColor}</label>
                                <div className="flex gap-2 overflow-x-auto p-2 -mx-2 custom-scrollbar">
                                    {colorOptions.map(option => {
                                        const isSelected = compForm.color === option.id;
                                        return (
                                            <button key={option.id} onClick={() => setCompForm({...compForm, color: option.id})} className={`group relative flex-shrink-0 flex items-center justify-center p-1.5 rounded-xl border-2 transition-all duration-300 outline-none focus:outline-none focus:ring-0 ${isSelected ? 'border-indigo-500 bg-indigo-50 dark:bg-indigo-500/10 dark:border-indigo-400 shadow-md scale-110 z-10' : 'border-transparent bg-slate-100 dark:bg-slate-800/50 hover:border-slate-200 dark:hover:border-slate-700 hover:shadow-sm'}`} title={option.label}>
                                                <div className={`w-8 h-8 rounded-lg bg-gradient-to-br ${option.gradient} shadow-sm flex items-center justify-center text-white transition-transform duration-300 ${isSelected ? 'scale-90' : 'group-hover:scale-105'}`}><Icon name={isSelected ? "check" : option.icon} size={16} strokeWidth={3} /></div>
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>

                            <div className="pt-2 border-t border-slate-100 dark:border-slate-800">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1">{t.startLabel}</label>
                                        <div className="flex gap-2">
                                            <div className="relative w-[60%]"><input type="date" value={compForm.startDate} onChange={e => setCompForm({...compForm, startDate: e.target.value})} className="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-xl px-3 py-3 text-base font-rounded font-bold outline-none focus:ring-2 focus:ring-indigo-500 transition-all" style={{colorScheme: theme === 'dark' ? 'dark' : 'light'}} /></div>
                                            <div className="flex items-center justify-center w-[40%] bg-slate-100 dark:bg-slate-800 rounded-xl px-3"><select value={compForm.startHour} onChange={e => setCompForm({...compForm, startHour: e.target.value})} className="bg-transparent border-none text-base font-rounded font-bold py-3 outline-none cursor-pointer text-center flex-1 appearance-none hover:text-indigo-500 transition-colors">{hours.map(h=><option key={h} value={h}>{h}</option>)}</select><span className="text-slate-400 font-bold text-base px-1 shrink-0">:</span><select value={compForm.startMinute} onChange={e => setCompForm({...compForm, startMinute: e.target.value})} className="bg-transparent border-none text-base font-rounded font-bold py-3 outline-none cursor-pointer text-center flex-1 appearance-none hover:text-indigo-500 transition-colors">{minutes.map(m=><option key={m} value={m}>{m}</option>)}</select></div>
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-slate-500 dark:text-slate-400 mb-1">{t.endLabel}</label>
                                        <div className="flex gap-2">
                                            <div className="relative w-[60%]"><input type="date" value={compForm.endDate} onChange={e => setCompForm({...compForm, endDate: e.target.value})} className="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-xl px-3 py-3 text-base font-rounded font-bold outline-none focus:ring-2 focus:ring-indigo-500 transition-all" style={{colorScheme: theme === 'dark' ? 'dark' : 'light'}} /></div>
                                            <div className="flex items-center justify-center w-[40%] bg-slate-100 dark:bg-slate-800 rounded-xl px-3"><select value={compForm.endHour} onChange={e => setCompForm({...compForm, endHour: e.target.value})} className="bg-transparent border-none text-base font-rounded font-bold py-3 outline-none cursor-pointer text-center flex-1 appearance-none hover:text-indigo-500 transition-colors">{hours.map(h=><option key={h} value={h}>{h}</option>)}</select><span className="text-slate-400 font-bold text-base px-1 shrink-0">:</span><select value={compForm.endMinute} onChange={e => setCompForm({...compForm, endMinute: e.target.value})} className="bg-transparent border-none text-base font-rounded font-bold py-3 outline-none cursor-pointer text-center flex-1 appearance-none hover:text-indigo-500 transition-colors">{minutes.map(m=><option key={m} value={m}>{m}</option>)}</select></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="flex gap-3 pt-4">
                                <button onClick={() => setShowManageModal(false)} className="flex-1 bg-slate-100 hover:bg-slate-200 dark:bg-slate-800 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 font-bold py-3 rounded-xl transition-all text-xs">{t.cancel}</button>
                                <button onClick={handleSaveCompetition} className="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl shadow-lg shadow-indigo-500/30 active:scale-[0.98] transition-all text-xs">{t.save}</button>
                            </div>
                        </div>
                    </Modal>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>